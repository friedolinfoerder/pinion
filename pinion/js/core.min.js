pinion.$window=jQuery(window);pinion.$document=jQuery(document);jQuery(function($){pinion.$head=$("head");pinion.$body=$("body")});pinion.DEBUG=true;pinion.modules={};if(typeof Array.isArray==="undefined")Array.isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]"};if(typeof Array.indexOf==="undefined"){Array.prototype.indexOf=function(elt){var len=this.length;var from=Number(arguments[1])||0;from=(from<0)?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++)if(from in this&&this[from]===elt)return from;return -1}};if(typeof Object.create==="undefined"){Object.create=(function(parent,o){var F=function(){};return function(parent,o){F.prototype=parent;var f=new F();if(typeof o==="object")for(var i in o)f[i]=o[i];return f}}())};pinion.getId=(function(){var counter=0;return function(){return (+new Date())+"_"+(counter++)}}());pinion.getIds=function(howMany){var toReturn=[];for(var i=howMany;i--;)toReturn.push(pinion.getId());return toReturn};pinion.$=function(obj){var $elements=jQuery([]);if(Array.isArray(obj))for(var i=0,length=obj.length;i<length;i++)$elements=$elements.add(obj[i].$element);else if(typeof obj==="object")$elements=obj.$element;return $elements};pinion.processArray=function(items,process,context,roundCallback,completeCallback){var todo=items.concat(),length=items.length,start,status,func=function(){start=+new Date(),status=Math.round((length-todo.length)/length*100);do{process.call(context,todo.shift())}while(todo.length>0&&(+new Date()-start<25));roundCallback(status);if(todo.length>0)setTimeout(func,25);else if(completeCallback instanceof Function)completeCallback.call(context,items);else if(completeCallback)context[completeCallback](items)};setTimeout(func,25)};pinion.require=(function(){var loaded={},waiting={};return function(jsOrCssFile,callback){var isArray=false,copy=null;if(Array.isArray(jsOrCssFile)){isArray=true;if(jsOrCssFile.length==0){if(callback instanceof Function)callback();return};copy=jsOrCssFile.concat();jsOrCssFile=copy.shift()};if(loaded[jsOrCssFile]!==undefined){if(loaded[jsOrCssFile]){if(isArray)pinion.require(copy,callback);else if(callback instanceof Function)callback()}else waiting[jsOrCssFile].push(function(){if(isArray)pinion.require(copy,callback);else if(callback instanceof Function)callback()});return};if(jsOrCssFile.split(".").pop()=="css"){console.info("stylesheet added: ",jsOrCssFile);pinion.$head.append('<link rel="stylesheet" href="'+jsOrCssFile+'" type="text/css"></link>');loaded[jsOrCssFile]=true;if(isArray)pinion.require(copy,callback);else if(callback instanceof Function)callback();return};loaded[jsOrCssFile]=false;waiting[jsOrCssFile]=[];var script=document.getElementsByTagName("script")[0],newJs=document.createElement("script");newJs.onreadystatechange=function(){if(newJs.readyState==="loaded"||newJs.readyState==="complete"){newJs.onreadystatechange=null;newJs.onload=null;console.info("javascript file added: ",jsOrCssFile);if(isArray)pinion.require(copy,callback);else if(callback instanceof Function)callback();for(var i=waiting[jsOrCssFile].length;i--;)waiting[jsOrCssFile][i]();loaded[jsOrCssFile]=true;delete waiting[jsOrCssFile]}};newJs.onload=function(){console.info("javascript file added: ",jsOrCssFile);if(isArray)pinion.require(copy,callback);else if(callback instanceof Function)callback();for(var i=waiting[jsOrCssFile].length;i--;)waiting[jsOrCssFile][i]();loaded[jsOrCssFile]=true;delete waiting[jsOrCssFile]};newJs.src=jsOrCssFile;script.parentNode.insertBefore(newJs,script)}}());pinion.length=function(obj){if(Array.isArray(obj))return obj.length;else{var size=0,key;for(key in obj)if(obj.hasOwnProperty(key))size++;return size}};pinion.isEmpty=function(obj){if(Array.isArray(obj))return (obj.length==0);else{for(var i in obj)return false;return true}};pinion.sprintf=function(str){if(arguments.length<2)return false;var vars=str.match(/%([sdb]|[0-9]+\$[sdb])/g),counter=1,types={s:function(arg){switch(typeof (arg)){case"number":return arg.toString();case"boolean":return arg?"true":"false"};return arg},d:function(arg){switch(typeof (arg)){case"string":return parseInt(arg,10);case"boolean":return arg?1:0};return arg},b:function(arg){return arg?"true":"false"}};for(var i=0,length=vars.length;i<length;i++){var type=vars[i].slice(-1);var matches=vars[i].match(/[0-9]+/);var index;if(matches)index=matches[0].slice(-1);else index=counter++;str=str.replace(vars[i],types[type](arguments[index]))};return str};pinion.hasPermission=function(module,permission){if(pinion.php.permissions[module]===undefined)return false;if(pinion.php.permissions[module][permission]===undefined)return false;return true};pinion.numberize=function(number,size){var $number=jQuery("<div class='pinion-number'></div>"),numberStr=number.toString(10),mapping=["zero","one","two","three","four","five","six","seven","eight","nine"],sizes=[0,40,40,26,19,16,13],length=numberStr.length,size=size||sizes[length];for(var i=0;i<length;i++){var c=numberStr[i];$number.append("<span class='pinion-"+mapping[c]+"-"+size+"'><span>"+c+"</span></span>")};return $number};pinion.translate=(function(){var translateBackend=function(word){var lowerWord=word.toLowerCase();if(pinion.translations===undefined)return word;else if(pinion.translations[lowerWord]===undefined)return word;else if(pinion.translations[lowerWord][pinion.php.language]===undefined)return word;else return pinion.translations[lowerWord][pinion.php.language]};return function(word){if(arguments.length>1){var args=Array.prototype.slice.call(arguments);var translateAll=false;if(typeof args[0]==="boolean")translateAll=args.shift();if(translateAll)for(var i=0,length=args.length;i<length;i++)args[i]=translateBackend(args[i]);else args[0]=translateBackend(args[0]);return pinion.sprintf.apply(null,args)}else return translateBackend(word)}}());jQuery.noConflict();var pinion=pinion||{};pinion._uniqueCounter=0;pinion.uniqueID=function(){return pinion._uniqueCounter++};pinion.date={};pinion.drag={refresh:false,connections:{}};jQuery(function($){pinion.$backend=$("#pinion-backend");pinion.$help=$("#pinion-help");pinion.$helpTextWrapper=pinion.$help.children();pinion.$helpText=pinion.$helpTextWrapper.children();var $contextHelp=pinion.$contextHelp=$("#pinion-contextHelp");pinion.$document.mousemove(function(event){$contextHelp.css({left:event.pageX,top:event.pageY})})});jQuery(function($){var $body=$(window);$body.scroll(function(){pinion.scroll.top=$body.scrollTop(),pinion.scroll.left=$body.scrollLeft()});pinion.scroll={top:$body.scrollTop(),left:$body.scrollLeft()}});pinion.date.timezoneOffset=new Date().getTimezoneOffset()/60;if(pinion.php===undefined||pinion.php.timezoneOffset===undefined||(pinion.php.timezoneOffset!==pinion.date.timezoneOffset))jQuery.post(pinion.php.url,{timezoneOffset:pinion.date.timezoneOffset});pinion.inherit=(function(){var F=function(){};return function(C,P){F.prototype=P.prototype;C.prototype=new F();C.uber=P.prototype;C.prototype.constructor=C}}());pinion.namespace=function(namespace){var parts=namespace.split("."),parent=pinion,i;if(parts[0]==="pinion")parts=parts.slice(1);for(i=0;i<parts.length;i+=1){if(typeof parent[parts[i]]==="undefined")parent[parts[i]]={};parent=parent[parts[i]]};return parent};pinion.namespace("pinion.backend.module");pinion.backend.plugins={};pinion.backend.usePlugins=(function(){var allPlugins=pinion.backend.plugins;return function(){var plugins=this.settings.plugins;for(var i=plugins.length;i--;)allPlugins[plugins[i]].call(this)}}());pinion.ajax=(function($){var cachedArguments={events:[],callbacks:[]},ajaxCount=0,ajaxCallback=function(data){var messages=data.messages;if(messages!==undefined)for(var i=messages.length;i--;){var msg=messages[i];msg.server=true;pinion.showMessage(msg)};if(data.restart!==undefined){window.location.reload();return};if(data.backend!==undefined){if(pinion.backendDisplays[data.backend.name]!==undefined)pinion.refreshBackend(data.backend);else pinion.showBackend(data.backend)};if(data.content!==undefined){var files=data.files||[];pinion.require(files,function(){var phpContent=pinion.php.content,content=data.content,currentContent;for(var id in content){currentContent=content[id];if(currentContent.remove){pinion.Frontend.removeContent(id);continue};if(phpContent[id]===undefined)phpContent[id]={};phpContent[id].vars=currentContent.vars;phpContent[id].data=currentContent.data;phpContent[id].content=currentContent.content;pinion.Frontend.replaceContent(id,currentContent.html,currentContent.identifier)}})}else if(data.files)pinion.require(data.files);var download=data.download;if(download!==undefined)for(var i=download.length;i--;)window.open(download[i],"_blank");var eval=data.eval;if(typeof eval==="string")new Function(eval).call(data);else if(Array.isArray(eval))for(var i=0,length=eval.length;i<length;i++)new Function(eval[i]).call(data)},processAjax=function(){var data={events:$.extend(true,[],cachedArguments.events)},callbacks=$.extend(true,[],cachedArguments.callbacks),callback=function(d){ajaxCallback(d);for(var i=0,length=callbacks.length;i<length;i++){var fn=callbacks[i];fn(d)}};cachedArguments={events:[],callbacks:[]};if(data.events.length==0){callback({});return false};return $.ajax({type:"post",data:$.toJSON(data),dataType:"json",success:callback,error:function(jqXHR,textStatus,errorThrown){console.log(jqXHR,textStatus,errorThrown);pinion.showMessage({type:"error",text:pinion.translate("An error on the server occured.")})}})};pinion.ajaxCallback=ajaxCallback;return function(data,callback){if(Array.isArray(data))cachedArguments.events=cachedArguments.events.concat(data);else if(typeof data==="object")cachedArguments.events.push(data);else throw Error("'data' is not a valid event-source.");if(callback instanceof Function)cachedArguments.callbacks.push(callback);if(pinion.ajax.collect){var count=++ajaxCount;setTimeout(function(){if(count==ajaxCount){processAjax();pinion.ajax.collect=false}else return false},100)}else processAjax()}}(jQuery));pinion.ajax.collect=false;pinion.activeBackend=null;pinion.$document.keydown(function(event){var code=event.which,esc=27;if(event.which==esc){if(pinion.activeBackend){pinion.backendDisplays[pinion.activeBackend].$closeButton.click();return false}}});pinion.backendDisplays={};pinion.showBackend=function(backendData){if(pinion.activeBackend){if(typeof backendData==="string"){if(backendData===pinion.activeBackend)return}else if(backendData.name===pinion.activeBackend)return};pinion.FrontendBox.hide();pinion.backend.Overlay.show();var type=0;if(typeof backendData==="string"){if(pinion.backendDisplays[backendData]!==undefined){type=1;jQuery("#pinion-backend-minimizeLinks").children("[data-module="+backendData+"]").animate({"margin-top":50},400,function(){jQuery(this).remove()})}}else if(pinion.backendDisplays[backendData.name]!==undefined){type=2;jQuery("#pinion-backend-minimizeLinks").children("[data-module="+backendData.name+"]").animate({"margin-top":50},400,function(){jQuery(this).remove()})};pinion.hideBackend(function(){if(type==1)pinion.backendDisplays[backendData].slideOpen();else if(type==2)pinion.backendDisplays[backendData.name].slideOpen();else{pinion.backendDisplays[backendData.name]=new pinion.backend.BackendDisplay(backendData);pinion.backendDisplays[backendData.name].slideOpen()}})};pinion.hideBackend=function(callback){if(pinion.activeBackend!=null){var activeBackend=pinion.activeBackend;pinion.backendDisplays[pinion.activeBackend].slideClose(function(){var module=pinion.backendDisplays[activeBackend];jQuery("<li data-module='"+module.backend.name+"'><a href='pinion/modules/"+module.backend.name+"'><span class='icon'><img src='"+module.backend.icon+"' width='25px' /></span><span class='text'>"+pinion.translate(module.backend.title)+"</span></a></li>").appendTo("#pinion-backend-minimizeLinks").css("margin-top",50).animate({"margin-top":9},400).children("a").click(function(){var $this=jQuery(this);if($this.data("inProgress")===undefined){$this.data("inProgress",true);pinion.page($this.attr("href"))};return false}).textRunner();if(callback instanceof Function)callback()})}else if(callback instanceof Function)callback()};pinion.refreshBackend=function(backendData){var oldModule=pinion.backendDisplays[backendData.name];oldModule.$element.remove();if(backendData.info===undefined)backendData.info={};if(backendData.info.tab===undefined){var $tabsLeft=pinion.backendDisplays[backendData.name].$tabsLeft;if($tabsLeft)backendData.info.tab=$tabsLeft.children(".active").attr("data-title")};pinion.backendDisplays[backendData.name]=new pinion.backend.BackendDisplay(backendData);pinion.backendDisplays[backendData.name].toPosition();pinion.Resetter.hide()};pinion.messages=jQuery.cookie("pinion.messages");pinion.messages=pinion.messages?jQuery.evalJSON(pinion.messages):[];pinion.showMessage=(function($){$.cookie("pinion.messages");var modules=pinion.php.modules,messages=pinion.messages,successSound=new Audio(pinion.php.url+"pinion/assets/sounds/beep.wav"),$messages,$logo,inAction=false,defaults={type:"info",server:false,icon:false},addMessage=function(msg){messages.push(msg);while(messages.length>100)messages.shift();$.cookie("pinion.messages",$.toJSON(messages),{expires:30})},animateMessage=function(){var $children=$messages.children();if($children.length<2){inAction=false;return};$children.last().prependTo($messages).css("margin-top","-33px").animate({"margin-top":0},500,function(){var $this=$(this);var $next;if($this.is($logo)){$next=$this.next();addMessage($next.data("msg"));$next.remove()}else{successSound.play();if(!$this.next().is($logo)){$next=$this.next();addMessage($next.data("msg"));$next.remove()}};setTimeout(animateMessage,2000-$children.length*50)})};$(function(){$messages=$("#pinion-messages");$logo=$messages.children("#pinion-logo")});return function(msg){if(typeof msg==="string")msg={text:msg};msg=$.extend({},defaults,msg);var icon=(msg.module)?"<span class='icon'><img src='"+modules[msg.module].icon+"' width='25px' /></span>":"";pinion.$link(icon+msg.text,"message","system messages").addClass(msg.type).addClass("pinion-message").data("msg",msg).insertAfter($logo);if(!inAction){inAction=true;setTimeout(animateMessage,300)}}}(jQuery));pinion.registerHelp=function($element,context,full){if(context!=null)pinion.registerContextHelp($element,context);if(full!=null)pinion.registerFullHelp($element,full)};pinion.registerFullHelp=(function(){var currentHelp=null,open=false;return function($element,text){$element.hover(function(){var elementHelp=(+new Date());currentHelp=elementHelp;if(!open){setTimeout(function(){if(currentHelp==elementHelp){open=true;pinion.$helpText.html(text);var currentHeight=pinion.$helpTextWrapper.outerHeight();pinion.$help.animate({height:currentHeight},300)}},1000)}else{pinion.$helpText.html(text);var currentHeight=pinion.$helpTextWrapper.outerHeight();pinion.$help.css({height:currentHeight})}},function(){var elementHelp=(+new Date());setTimeout(function(){if(elementHelp>currentHelp){open=false;currentHelp=null;pinion.$help.animate({height:0},300)}},500)})}}());pinion.registerContextHelp=(function(){var currentHelp=null,open=false;return function($element,text){$element.hover(function(){var elementHelp=(+new Date());currentHelp=elementHelp;if(!open){setTimeout(function(){if(currentHelp==elementHelp){open=true;pinion.$contextHelp.html(text).fadeIn(300)}},500)}else pinion.$contextHelp.html(text)},function(){var elementHelp=(+new Date());setTimeout(function(){if(elementHelp>currentHelp){open=false;currentHelp=null;pinion.$contextHelp.fadeOut(300)}},300)})}}());pinion.addInfo=function(events,info){if(Array.isArray(events)){var newEvents=jQuery.extend(true,[],events);for(var i=0,length=newEvents.length;i<length;i++){var event=newEvents[i];for(var j in info)event.info[j]=info[j]}}else{newEvents=jQuery.extend(true,{},events);for(var j in info)newEvents.info[j]=info[j]};return newEvents};pinion.page=function(url,callback){var parts=url.split("/"),postData={},moduleParts,module,tab;if(parts[0]==="pinion"){if(parts[1]==="modules"){moduleParts=parts[2].split("#");module=moduleParts[0];if(moduleParts.length>1)tab=moduleParts[1];if(pinion.backendDisplays[module]!==undefined&&!(parts.length>3&&parts[3]=="refresh")){pinion.showBackend(module);if(tab)pinion.backendDisplays[module].openTab(tab);if(callback instanceof Function)callback();return true};postData={module:module,event:"backend"};if(tab)postData.info={tab:tab.toLowerCase()};pinion.ajax(postData,callback)}};return true};jQuery("a.pinion-link").live("click",function(){var $this=jQuery(this);pinion.page($this.attr("href"),$this.data("callback"));return false});pinion.$link=function(html,module,tab,callback){if(tab instanceof Function)return pinion.$link(html,module,null,tab);tab=tab?"#"+tab:"";if(pinion.hasPermission(module,"backend")){var $element=jQuery("<a class='pinion-link' href='pinion/modules/"+module+tab+"'>"+html+"</a>");if(callback)$element.data("callback",callback);return $element}else return jQuery("<span>"+html+"</span>")};pinion.preview=function(moduleName,content){return new pinion.modules[moduleName].Preview(content).$element.addClass("pinion-modules-"+moduleName+"-Preview")};pinion.EventDispatcher=(function(){var constr;constr=function(){};constr.prototype={on:function(event,data,callback,context){if(this.handlers[event]===undefined)this.handlers[event]=[];if(data instanceof Function||typeof data==="string"){context=callback||this;callback=data;data={}};this.handlers[event].push({data:data,callback:callback,context:context||this});return this},one:function(event,data,callback,context){if(this.handlers[event]===undefined)this.handlers[event]=[];if(data instanceof Function||typeof data==="string"){context=callback||this;callback=data;data={}};this.handlers[event].push({data:data,callback:callback,context:context||this,one:true});return this},off:function(event,callback,context){var i,length,handler;if(event===undefined)this.handlers={};else if(this.handlers[event]!==undefined){if(callback===undefined)delete this.handlers[event];else if(context===undefined){if(typeof callback==="string"){for(i=this.handlers[event].length;i--;){handler=this.handlers[event][i];if(handler.callback===callback)this.handlers[event].splice(i,1)}}else{context=callback;for(i=this.handlers[event].length;i--;){handler=this.handlers[event][i];if(handler.context===context)this.handlers[event].splice(i,1)}}}else for(i=this.handlers[event].length;i--;){handler=this.handlers[event][i];if(handler.callback===callback&&handler.context===context)this.handlers[event].splice(i,1)}};return this},hasOn:function(event,context){if(context===undefined)context=this;if(this.handlers[event]===undefined)return false;for(var i=this.handlers[event].length;i--;){var handler=this.handlers[event][i];if(context===handler.context)return true}},fire:function(event,info){var toReturn=true;if(this.handlers[event]!==undefined){for(var i=this.handlers[event].length;i--;){var handler=this.handlers[event][i],context=handler.context,data=handler.data,one=handler.one;var completeInfo=jQuery.extend({sender:this},info);if(handler.callback instanceof Function){if(handler.callback.call(context,completeInfo,data)===false)toReturn=false}else if(typeof handler.callback==="string"){if(context[handler.callback](completeInfo,data)===false)toReturn=false};if(one)delete this.handlers[event].splice(i,1)}};return toReturn},fireRecursive:function(event,info){this.fire(event,info);for(var i=this.children.length;i--;){var child=this.children[i];child.fireRecursive(event,info)}}};return constr}());pinion.handlers={};jQuery.extend(pinion,pinion.EventDispatcher.prototype);pinion.FrontendBox=(function($){var doAnimation=false,$clickStopper,$scrollLeft=$("<div class='pinion-FrontendBox-control'><span class='pinion-FrontendBox-icon-arrow'></span></div>").mousedown(function(){if(args[2].steps!==undefined){if(doAnimation)return;if(currentPage>0){var $children=args[2].$children,howMany=args[2].howMany,start=(currentPage-1)*howMany,end=start+howMany,$newChildren=$children.slice(start,end).show();$contentInner.css("left",-(wrapperWidth-10));doAnimation=true;$contentInner.animate({left:0},500,function(){args[2].$shownChildren.hide();args[2].$shownChildren=$newChildren;$currentPage.text(currentPage--);doAnimation=false})}}else{startScrolling(-1);pinion.$document.one("mouseup",function(){stopScrolling()})}}),$currentPage=$("<span class='current'></span>"),$totalPage=$("<span class='total'></span>"),$pager=$("<div class='pinion-FrontendBox-pager'></div>").append($currentPage).append("<span> / </span>").append($totalPage),$scrollRight=$("<div class='pinion-FrontendBox-control'><span class='pinion-FrontendBox-icon-arrow'></span></div>").mousedown(function(){if(args[2].steps!==undefined){if(doAnimation)return;if(currentPage<numPages-1){doAnimation=true;var $children=args[2].$children,howMany=args[2].howMany,start=(currentPage+1)*howMany,end=start+howMany,$newChildren=$children.slice(start,end).show();$contentInner.animate({left:-(wrapperWidth-10)},500,function(){$contentInner.css("left",0);args[2].$shownChildren.hide();args[2].$shownChildren=$newChildren;currentPage++;$currentPage.text(currentPage+1);doAnimation=false})}}else{startScrolling(1);pinion.$document.one("mouseup",function(){stopScrolling()})}}),$contentInner=$("<div class='pinion-FrontendBox-content'></div>"),$contentWrapper=$("<div class='pinion-FrontendBox-contentWrapper'></div>").mousewheel(function(event,delta){if(delta<0)$scrollRight.trigger("mousedown");else $scrollLeft.trigger("mousedown");pinion.$document.trigger("mouseup");return false}).append($contentInner),$searchInput=$("<input type='text' />").keyup((function(){var time;return function(){var $this=$(this);var mySearchTime=+new Date();time=mySearchTime;setTimeout(function(){if(time==mySearchTime){var val=$this.val(),$content=args[1],$lis=$content.children("li");$lis.show();if(val==""){$search.removeClass("search-active");$lis.removeClass("pinion-rejected")}else{$search.addClass("search-active");$lis.each(function(){var $this=$(this),index=$this.text().toLowerCase().indexOf(val.toLowerCase());if(index===-1)$this.addClass("pinion-rejected").hide();else $this.removeClass("pinion-rejected")})};update()}})}}())),$search=$("<div class='pinion-backend-menu-search'></div>").append($searchInput).append("<div class='pinion-backend-icon-search'></div>"),$frontendBox=$("<div id='pinion-FrontendBox'></div>").append($scrollLeft).append($contentWrapper).append($scrollRight).append($pager).append($search),offset,height,width,wrapperWidth,marginLeft,maxWidth,parentWidth,parentHeight,parentCenter,args,numPages,currentPage,show=function($parent,$content,options){if(options===undefined)options={};if(args==null){this.fire("show",{$parent:$parent,$content:$content,options:options});$parent.addClass("pinion-active")}else if(args[0]!=$parent){this.fire("hide",{$parent:args[0],$content:args[1],options:args[2]});this.fire("show",{$parent:$parent,$content:$content,options:options});args[0].removeClass("pinion-active");resetSearch();$parent.addClass("pinion-active")};if(options.steps!==undefined)var $children=$content.children(":not(.pinion-rejected)").show();args=[$parent,$content,options];$frontendBox.css("height","").removeClass("pinion-scrollable").show();$contentWrapper.css("width",10000);$contentInner.css("width","");stopScrolling();$contentInner.css("left","0px");$contentInner.children().detach();$contentInner.append($content);offset=$parent.offset();width=$contentInner.outerWidth();marginLeft=30;maxWidth=pinion.$window.width()-2*marginLeft;parentWidth=$parent.outerWidth();parentCenter=offset.left+parentWidth/2;$contentInner.css("width",width-10);var positionLeft;if(width>maxWidth){$frontendBox.addClass("pinion-scrollable");wrapperWidth=maxWidth-40;if(options.steps!==undefined){var numChildren=$children.hide().length,effectiveWidth=wrapperWidth-10,tooMuch=effectiveWidth%options.steps,realWidth=effectiveWidth-tooMuch,howMany=realWidth/options.steps;args[2].howMany=howMany;args[2].$children=$children;wrapperWidth-=tooMuch;positionLeft=marginLeft+Math.floor(tooMuch/2);numPages=Math.ceil(numChildren/howMany);currentPage=0;$currentPage.text(1);$totalPage.text(numPages);args[2].$shownChildren=$children.filter(":lt("+howMany+")").show()}}else{wrapperWidth=width;if(parentCenter-width/2<marginLeft)positionLeft=marginLeft;else if(parentCenter+width/2>marginLeft+maxWidth)positionLeft=marginLeft+maxWidth-width;else positionLeft=parentCenter-width/2};height=$contentInner.outerHeight();parentHeight=$parent.outerHeight();$frontendBox.css("height",height);if(offset.top-height-60>pinion.scroll.top)$frontendBox.removeClass("pinion-bottom").css("top",offset.top-height);else $frontendBox.addClass("pinion-bottom").css("top",offset.top+parentHeight);$contentWrapper.css("width",wrapperWidth);$frontendBox.css("left",positionLeft);$clickStopper.show()},hide=function(){if(args){resetSearch();this.fire("hide",{$parent:args[0],$content:args[1],options:args[2]});args[0].removeClass("pinion-active");$frontendBox.hide();stopScrolling();args=null};$clickStopper.hide()},resetSearch=function(){if($search.hasClass("search-active")){$search.removeClass("search-active");$searchInput.val("");args[1].children("li").removeClass("pinion-rejected")}},scrollIntervalId=null,stopScrolling=function(){if(scrollIntervalId!=null){clearInterval(scrollIntervalId);scrollIntervalId=null}},startScrolling=function(direction){var scrollFunction,speed=5,left=parseInt($contentInner.css("left"),10);if(direction==1){scrollFunction=function(){if(left<wrapperWidth-width+speed){left=wrapperWidth-width;$contentInner.css("left",left);stopScrolling()}else if(width+left>wrapperWidth){left-=speed;$contentInner.css("left",left)}}}else scrollFunction=function(){if(left>-speed){left=0;$contentInner.css("left",left);stopScrolling()}else if(left<0){left+=speed;$contentInner.css("left",left)}};scrollIntervalId=setInterval(scrollFunction,40)},getParent=function(){return args?args[0]:null},update=function(){if(args)show.apply(pinion.FrontendBox,args)},loader=null,showLoader=function(){if(loader==null){loader=new pinion.Loader("default-40px",40);loader.$element.appendTo($contentWrapper)}},hideLoader=function(){loader.remove();loader=null};$(function(){$("body").append($frontendBox);$clickStopper=$("#pinion-backend-menuClickStopper")});pinion.$window.bind("resize",function(){if(args)show.apply(pinion.FrontendBox,args)});return $.extend({handlers:{},show:show,hide:hide,update:update,getParent:getParent,showLoader:showLoader,hideLoader:hideLoader},pinion.EventDispatcher.prototype)}(jQuery));pinion.Loader=(function($){var constr,url=pinion.php.url;constr=function(type,size){var _this=this,size=size||20,$canvas=$("<canvas width='"+size+"' heigth='"+size+"' class='pinion-Loader'></canvas>"),context=$canvas.get(0).getContext("2d"),rot=0,img=new Image();if(typeof type!="string")type="default";img.src=url+"pinion/assets/images/loader/loader_"+type+".png";img.onload=function(){_this.intervalID=setInterval(function(){context.clearRect(0,0,size,size);context.save();context.translate(size/2,size/2);context.rotate(rot*Math.PI*2/8);context.drawImage(img,-size/2,-size/2);context.restore();rot++},80)};this.$element=$canvas};constr.prototype={constructor:pinion.Loader,remove:function(){clearInterval(this.intervalID);this.$element.remove()}};return constr}(jQuery));pinion.Resetter=(function($){var constr,elementToReset,$resetContainer=$("<div class='pinion-reset-container'></div>").append("<a href='#'>"+pinion.translate("reset")+"</a>").hide().mouseleave(function(){$resetContainer.hide()}).children("a").click(function(){elementToReset.backend.resetElement(elementToReset);$resetContainer.hide();return false}).end();$(function(){$resetContainer.appendTo("body")});constr=function(element){return $("<span class='pinion-backend-icon-dirty'></span>").mouseenter(function(){elementToReset=element;var offset=$(this).offset();$resetContainer.css(offset).show()})};constr.hide=function(){$resetContainer.hide()};constr.prototype={constructor:pinion.Resetter};return constr}(jQuery));pinion.namespace("backend.ElementBase");pinion.backend.ElementBase=(function($){var constr,usePlugins=pinion.backend.usePlugins;constr=function(){};constr.changeParent=function(elements,parent){var id=parent.identifier;for(var i=elements.length;i--;)if(elements[i].parent==null)elements[i].parent=id;return elements};constr.getElements=function(element,elements){elements[element.identifier]=element;var children=element.children;for(var i=children.length;i--;)constr.getDirtyElements(children[i],elements)};constr.getDirtyElements=function(element,dirtyElements){if(element.isDirty()){dirtyElements[element.identifier]=element;var children=element.children;for(var i=children.length;i--;)constr.getDirtyElements(children[i],dirtyElements)}};constr.prototype={constructor:pinion.backend.ElementBase,globalElementSettings:{validate:"dirty",groupEvents:false,groupMode:"array",validators:{},dirty:"change",events:[],info:{},listener:{},help:null,fullHelp:null,style:{},classes:"",lazy:false,plugins:[],fire:null,eval:null},isDirty:function(element){if(element===undefined)element=this;return element._isDirty},setDirty:function(element){if(element===undefined)element=this;var isDirty=true,parent=element.parent;element._isChanged=true;element.fire("change",element);element.fire("afterChange",element);if(element.settings.dirty=="never"||element.fire("dirty")===false)isDirty=false;if(element.validate instanceof Function)element.validate();if(isDirty){element._isDirty=true;this.dirtyElements[element.identifier]=element;if(parent){if(!parent.isDirty(parent))parent.setDirty(parent);else this.setChanged(parent)};element.$element.addClass("dirty");if(element.$dirtyFlag)element.$dirtyFlag.addClass("dirty")}else if(parent)this.setChanged(parent)},setClean:function(element,withoutValidation){if(element===undefined)element=this;var isClean=true,parent=element.parent;element._isChanged=false;element.fire("change",element);element.fire("afterChange",element);if(element.settings.dirty=="always"||element.fire("clean",element)===false)isClean=false;if(isClean){element._isDirty=false;if(this.dirtyElements[element.identifier]!==undefined)delete this.dirtyElements[element.identifier];if(parent){var children=parent.children;var allChildrenClean=true;for(var i=0,length=children.length;i<length;i++)if(this.isDirty(children[i])){allChildrenClean=false;break};if(allChildrenClean){parent.setClean(parent);for(i=0;i<length;i++)this.setValid(children[i])}else if(parent.settings.validate=="all"){if(element.validate instanceof Function&&withoutValidation!==true)element.validate();parent.setChanged(parent)}else{parent.setValid(element);parent.setChanged(parent)}};element.$element.removeClass("dirty");if(element.$dirtyFlag)element.$dirtyFlag.removeClass("dirty")}else if(parent)parent.setChanged(parent)},setChanged:function(element){if(element===undefined)element=this;element.fire("change",element);element.fire("afterChange");var parent=element.parent;if(parent)parent.setChanged(parent)},isInvalid:function(element){if(element===undefined)element=this;return (element._isValid!==true)},setValid:function(element){if(element===undefined)element=this;var _this=this,length,i;if(this.validations[element.identifier]!==undefined)delete this.validations[element.identifier];element._isValid=true;element.fire("valid");element.$element.removeClass("invalid");if(element.$dirtyFlag)element.$dirtyFlag.removeClass("invalid");var parent=element.parent;if(parent){var children=parent.children;var allChildrenValid=true;for(i=0,length=children.length;i<length;i++)if(children[i]._isValid===false){allChildrenValid=false;break};if(allChildrenValid)parent.setValid(parent)};if(element.$warning)element.$warning.slideUp(300);if(pinion.isEmpty(this.validations)){if(this.canSave){var events=this._collectEvents(this.dirtyElements);if(this.mode=="backend")events.push({event:"backend",module:this.name,info:{}});_this.fire("saveStart",{events:events});pinion.ajax(events,function(){_this.fire("saveDone")});this.canSave=false}else if(!pinion.isEmpty(this.dirtyElements))this.fire("savePossible")}},_collectEvents:function(dirtyElements){var events=[],_infos={},dirtyElement;for(var index in dirtyElements){dirtyElement=dirtyElements[index];var newEvent,_info,settings=dirtyElement.settings;if(dirtyElement.fire("save")===false)continue;for(var i=0,length=settings.events.length;i<length;i++){newEvent=settings.events[i];_info=this._getInfo(events,newEvent,dirtyElement,_infos);$.extend(_info,newEvent.info,dirtyElement.info)}};return events},_hasInfo:function(event,element,infos){var identifier=element.identifier;if(infos[identifier]===undefined)infos[identifier]={};if(infos[identifier][event.module]===undefined)infos[identifier][event.module]={};if(infos[identifier][event.module][event.event]===undefined){infos[identifier][event.module][event.event]={};return false}else return true},_getInfo:function(events,event,element,infos){var identifier=element.identifier,module=event.module,evt=event.event;if(this._hasInfo(event,element,infos))return infos[identifier][module][evt];var currentInfo=infos[identifier][module][evt];var groupParent=element.parent,groupParentSettings=groupParent?groupParent.settings:null;if(groupParent&&groupParentSettings.groupEvents){var path=[];do{var _hasInfo=this._hasInfo(event,groupParent,infos);currentInfo=infos[groupParent.identifier][module][evt];if(_hasInfo){if(typeof groupParentSettings.groupEvents==="string"){if(groupParentSettings.groupMode=="array"){var infoPart={};if(currentInfo[groupParentSettings.groupEvents]===undefined)currentInfo[groupParentSettings.groupEvents]=[];currentInfo[groupParentSettings.groupEvents].push(infoPart);currentInfo=infoPart}else{if(currentInfo[groupParentSettings.groupEvents]===undefined)currentInfo[groupParentSettings.groupEvents]={};currentInfo=currentInfo[groupParentSettings.groupEvents]}};break};path.push({elem:groupParent,info:currentInfo,namespace:groupParentSettings.groupEvents,mode:groupParentSettings.groupMode});groupParent=groupParent.parent;groupParentSettings=groupParent?groupParent.settings:null;if(!(groupParent&&groupParentSettings.groupEvents)){event=$.extend(true,{},event);event.info=currentInfo;events.push(event);break}}while(true);for(var i=path.length;i--;){var p=path[i],namespace=p.namespace,mode=p.mode;infos[p.elem.identifier][module][evt]=currentInfo;if(namespace!==true){if(mode=="array"){currentInfo=currentInfo[namespace]=[{}];currentInfo=currentInfo[0]}else if(mode=="object")currentInfo=currentInfo[namespace]={}}}}else{event=$.extend(true,{},event);event.info=currentInfo;events.push(event)};infos[identifier][module][evt]=currentInfo;return currentInfo},setInvalid:function(element,warningText){if(typeof element==="string"){warningText=element;element=this};this.canSave=false;this.validations[element.identifier]=element;element._isValid=false;element.fire("invalid");element.$element.addClass("invalid");if(element.$dirtyFlag)element.$dirtyFlag.addClass("invalid");var parent=element.parent;if(parent){if(parent._isValid!==false)parent.backend.setInvalid(parent)};if(warningText&&element.$warning)element.$warning.html(warningText).slideDown(300)},resetElement:function(element,afterSave){if(element._isDirty||element._isChanged){for(var length=element.children.length,i=length-1;i>=0;i--){var child=element.children[i];this.resetElement(child,afterSave)};if(element._isDirty&&element.settings.dirty!="always")this.setClean(element,true);if(afterSave)element.initSettings=$.extend(true,{},element.settings);else element.settings=$.extend(true,{},element.initSettings);if(element.reset instanceof Function)element.reset(afterSave)}},_inizializeElements:function(instance){var children=instance.children;for(var i=0,length=children.length;i<length;i++){var child=children[i];this._inizializeElements(child);if(child.init instanceof Function){if(!child._inizialized){child.init();child._inizialized=true;usePlugins.call(child)}};if(child.$warning)child.$warning.hide()}},addElements:function(elements,start){if(start===undefined)start=this;var currentLazyElement,currentLazyElementIdentifier;for(var i=0,length=elements.length;i<length;i++){var settings=elements[i];if(settings.lazy){if(!currentLazyElement){currentLazyElementIdentifier=settings.lazy;currentLazyElement=this.elements[currentLazyElementIdentifier]};if(currentLazyElementIdentifier==settings.lazy)settings.lazy=false;currentLazyElement.elements.push(settings)}else{this.doInitialization=false;this.addElement(settings);this.doInitialization=true;currentLazyElement=null}};this._inizializeElements(start)},addElement:function(settings,parent){if(settings.namespace===undefined)settings.namespace="backend";var func=pinion[settings.namespace][settings.type][settings.name];if(func===undefined){if(settings.namespace=="backend"&&settings.type=="module")func=pinion.backend.module.defaultModule;else throw Error("pinion."+settings.namespace+"."+settings.type+"."+settings.name+" is undefined!!")};var defaultSettings=func.prototype.defaultSettings||{};$.extend(func.prototype,pinion.EventDispatcher.prototype);func.prototype.backend=this;func.prototype.isDirty=function(){return this._isDirty};func.prototype.setDirty=function(){this.backend.setDirty(this);return this};func.prototype.setClean=function(){if(this.backend==this)return;this.backend.setClean(this);return this};func.prototype.setChanged=function(){this.backend.setChanged(this);return this};func.prototype.isInvalid=function(){return this.backend.isInvalid(this)};func.prototype.setValid=function(){if(this.backend==this)return;this.backend.setValid(this);return this};func.prototype.setInvalid=function(msg){this.backend.setInvalid(this,msg);return this};func.prototype.resetElement=function(){this.backend.resetElement(this);return this};func.prototype.replaceBy=function(settings,parent){if(settings.parent===undefined&&parent===undefined)parent=this.parent;return this.backend.replaceElement(this,settings,parent)};func.prototype.asParentFor=function(elements){constr.changeParent(elements,this);return this},func.prototype.addElements=function(settingsArray,start){if(start===undefined)start=this;this.backend.addElements(settingsArray,start);return this};func.prototype.addChild=function(settings){return this.backend.addElement(settings,this)};func.prototype.remove=function(){return this.backend.removeElement(this)};func.prototype.removeChildren=function(){if(this.children===undefined)return;while(this.children.length>0)this.children[0].remove()};func.prototype.getElement=function(identifier){return this.backend.elements[identifier]};func.prototype.getChildIndex=function(){return this.parent.children.indexOf(this)};func.prototype.siblings=function(){var children=this.parent.children;var toReturn=[];for(var i=0,length=children.length;i<length;i++){var child=children[i];if(child!=this)toReturn.push(child)};return toReturn};func.prototype.next=function(){var index=this.getChildIndex(),elements=this.parent.children;if(index<elements.length-1)return elements[index+1];return null};func.prototype.prev=function(){var index=this.getChildIndex();if(index>0){var elements=this.parent.children;return elements[index-1]};return null};func.prototype.find=function(index){return (this.backend.indices[index]||null)};func.prototype.hide=function(){this.$element.hide.apply(this.$element,arguments);this.fire("hide");return this};func.prototype.show=function(){this.$element.show.apply(this.$element,arguments);this.fire("show");return this};func.prototype.fadeOut=function(speed,callback){var _this=this;this.$element.fadeOut.call(this.$element,speed,function(){callback();_this.fire("hide")});return this};func.prototype.fadeIn=function(speed,callback){var _this=this;this.$element.fadeIn.call(this.$element,speed,function(){callback();_this.fire("show")});return this};func.prototype.appendTo=function(element){this.$element.appendTo(element.$element);return this};func.prototype.append=function(element){this.$element.append(element.$element);return this};func.prototype.after=function(element){this.$element.after(element.$element);return this};func.prototype.before=function(element){this.$element.before(element.$element);return this};func.prototype.insertAfter=function(element){this.$element.insertAfter(element.$element);return this};func.prototype.insertBefore=function(element){this.$element.insertBefore(element.$element);return this};settings=$.extend(true,{},this.globalElementSettings,defaultSettings,settings);if(settings.identifier===undefined)settings.identifier=settings.name+"_"+pinion.getId();var element=new func(settings,this);element.backend=this;element.handlers={};element._isDirty=false;element._isChanged=false;element._isValid=null;element.initSettings=$.extend(true,{},settings);if(element.settings===undefined)element.settings=settings;if(element.info===undefined)element.info=settings.info;if(element.validators===undefined)element.validators=settings.validators;element.identifier=settings.identifier;if(settings.type=="renderer")element.data=settings.data;this.elements[element.identifier]=element;if(settings.index)this.indices[settings.index]=element;if(element.$element===undefined&&settings.$element)element.$element=settings.$element;element.$element.data("element",element);if(element.$childrenContainer===undefined)element.$childrenContainer=element.$element;element.$childrenContainer.data("element",element);if(parent===undefined)parent=element.parent=(settings.parent===undefined)?this:this.elements[settings.parent];else{if(parent.$childrenContainer===undefined)parent.$childrenContainer=parent.$element;if(parent.children===undefined)parent.children=[];element.parent=parent;if(parent.settings!==undefined)element.settings.parent=parent.settings.identifier};if(parent.handlers===undefined)parent.handlers={};if(element.children===undefined)element.children=[];element.parent.children.push(element);element.$dirtyFlag=new pinion.Resetter(element);element.$element.css(settings.style).addClass(settings.classes).append(element.$dirtyFlag);if(!element.$element.is(element.parent.$childrenContainer))element.$element.appendTo(element.parent.$childrenContainer);pinion.registerHelp(element.$element,element.settings.help,element.settings.fullHelp);if(this.doInitialization!==false&&element.init instanceof Function){element.init();element._inizialized=true;usePlugins.call(element)};if(element.$warning)element.$warning.hide();if(settings.dirty=="always")element.setDirty();parent.fire("childAdded",{element:element});pinion.fire("create."+element.identifier,{element:element});pinion.fire("create."+this.name+"."+element.identifier,{element:element});var fire=settings.fire;if(fire){var type=typeof fire;if(type==="object")pinion.fire(fire.module+"."+fire.event,{element:element});else if(type==="string")pinion.fire(fire,{element:element})};var eval=settings.eval;if(typeof eval==="string"){var evalFunction=new Function(eval);evalFunction.call(element)};return element},removeElement:function(element){this._removeElement(element);element.$element.remove()},_removeElement:function(element){element.fire("remove");element.off();var children=element.children;for(var i=children.length;i--;)this._removeElement(children[i]);var parentChildren=element.parent.children,childIndex=parentChildren.indexOf(element);parentChildren.splice(childIndex,1);if(element.index)delete this.indices[element.index];delete this.dirtyElements[element.identifier];delete this.elements[element.identifier];element=null},replaceElement:function(oldElement,settingsOrElement,parent){var newElement;if(settingsOrElement.settings===undefined){if(settingsOrElement.identifier===undefined)settingsOrElement.identifier=oldElement.identifier;newElement=this.addElement(settingsOrElement,parent)}else newElement=settingsOrElement;oldElement.$element.after(newElement.$element);this.removeElement(oldElement);return newElement},save:function(){this.canSave=true;for(var i in this.dirtyElements){var element=this.dirtyElements[i];var validateAllCheck=function(elem){if(elem.settings.validate=="all"){var children=elem.children;for(var j=0,length=children.length;j<length;j++){var child=children[j];if(child.validate instanceof Function)this.validations[child.identifier]=child;validateAllCheck.call(this,child)}}};validateAllCheck.call(this,element);if(element.validate instanceof Function)this.validations[element.identifier]=element};var atLeastOneValidation=false;for(var validation in this.validations){atLeastOneValidation=true;this.validations[validation].validate()};if(!atLeastOneValidation)this.setValid(this)}};return constr}(jQuery));pinion.namespace("backend.BackendDisplay");pinion.backend.BackendDisplay=(function($){var constr,modules=pinion.php.modules;constr=function(backend){var _this=this,loader=null,info=backend.info||{},elements=backend.elements,$outerContainer=jQuery("<div class='pinion-backend-elements'><div class='pinion-backend-background'></div></div>"),$contentContainer=jQuery("<div class='pinion-backend-innerElementsContainer'></div>").appendTo($outerContainer),$scrollContainer=jQuery("<div class='pinion-backend-scrollContainer'></div>").appendTo($contentContainer),$innerContainer=jQuery("<div class='pinion-backend-innerContainer'></div>").appendTo($scrollContainer),$staticBottomContainer,$headline,i,length;$.extend(pinion.backend.BackendDisplay.prototype,pinion.EventDispatcher.prototype);this.handlers={};this.name=backend.name;var module=modules[this.name];this.title=module.title;this.icon=module.icon;this.mode="backend";this.slideClose=function(callback){pinion.activeBackend=null;$headline.animate({left:-$headline.width()-100+"px"},500);$outerContainer.css({width:$outerContainer.width()+"px",right:"auto"}).animate({left:window.innerWidth+$headline.width()+"px"},500,function(){_this.$element.hide();callback()})};this.slideOpen=function(){_this.$element.show();pinion.activeBackend=this.name;$headline.css({left:-$headline.width()+"px"}).animate({left:0},800);$outerContainer.css({width:window.innerWidth-_this.leftPosition-parseInt($outerContainer.css("padding-left"),10)-parseInt($outerContainer.css("padding-right"),10)+"px",right:"auto",left:window.innerWidth+$headline.width()+"px"}).animate({left:_this.leftPosition+"px"},800,function(){$outerContainer.css({right:0,width:"auto"});_this.fire("open")})},this.toPosition=function(){$headline.css("left",0);$outerContainer.css("left",_this.leftPosition);_this.fire("open")};this.dirtyElements={};this.validations={};this.elements={};this.indices={};this.tabs={left:[]};this.$element=$("<div></div>").addClass("pinion-backend-BackendDisplay").addClass("pinion-font").append($outerContainer).appendTo(pinion.$backend).bind("dirty.pinion",function(){$headline.addClass("dirty")}).bind("clean.pinion",function(){$headline.removeClass("dirty")});$headline=$("<h1>"+pinion.translate(this.title)+"</h1>").append(new pinion.Resetter(this)).appendTo(this.$element);var $iconSpan=$("<span class='iconWrapper'><img src='"+this.icon+"' /></span>").click(function(){pinion.addShortcut({name:_this.name,title:_this.title,icon:_this.icon})}).appendTo($headline);pinion.registerHelp($iconSpan,pinion.translate("add module %s to shortcuts","<i>"+this.title+"</i>"));var $closeButton=$("<div id='pinion-backend-closeButton' class='pinion-backend-button'></div>").append("<div class='pinion-backend-icon-close'></div>").click(function(){pinion.backend.Overlay.hide();pinion.ajax({event:"closeBackend",module:"backend"});delete pinion.backendDisplays[_this.name];_this.slideClose(function(){_this.$element.remove()})}).appendTo($outerContainer);pinion.registerHelp($closeButton,pinion.translate("close module %s","<i>"+this.title+"</i>"));this.$closeButton=$closeButton;var $minimizeButton=$("<div id='pinion-backend-minimizeButton' class='pinion-backend-button'></div>").append("<div class='pinion-backend-icon-minimize'></div>").click(function(){pinion.backend.Overlay.hide();pinion.hideBackend(_this.name)}).appendTo($outerContainer);pinion.registerHelp($minimizeButton,pinion.translate("minimize module %s","<i>"+this.title+"</i>"));var $refreshButton=$("<div id='pinion-backend-refreshButton' class='pinion-backend-button'></div>").append("<div class='pinion-backend-icon-refresh'></div>").click(function(){var $icon=$(this).children(),loader=new pinion.Loader("darkblue");$icon.hide().after(loader.$element);pinion.page("pinion/modules/"+_this.name+"/refresh",function(){loader.remove()})}).appendTo($outerContainer);pinion.registerHelp($refreshButton,pinion.translate("refresh module %s","<i>"+this.title+"</i>"));this.$outerContainer=$outerContainer;this.$childrenContainer=$innerContainer;this.$contentContainer=$contentContainer;$staticBottomContainer=$("<div class='pinion-backend-staticBottomContainer'></div>").appendTo($outerContainer);var $iconSave=$("<div class='pinion-backend-icon-save'></div>");this.$submitButton=$("<div class='pinion-backend-BackendDisplay-save'></div>").append($iconSave).append("<div class='pinion-backend-BackendDisplay-saveText'>save</div>").click(function(){if(_this.$submitButton.hasClass("disabled"))return;loader=new pinion.Loader("darkblue");_this.$submitButton.addClass("pinion-loading");$iconSave.append(loader.$element);_this.$submitButton.addClass("disabled");_this.save();_this.one("saveDone",function(){_this.$submitButton.removeClass("pinion-loading");loader.remove()})}).addClass("disabled").appendTo($staticBottomContainer);this.on("invalid",function(){this.$submitButton.addClass("disabled");if(loader!=null){this.$submitButton.removeClass("pinion-loading");loader.remove()}}).on("dirty",function(){if(pinion.isEmpty(this.validations))_this.$submitButton.removeClass("disabled")}).on("clean",function(){_this.$submitButton.addClass("disabled")}).on("savePossible",function(){_this.$submitButton.removeClass("disabled")});$("<div class='pinion-backend-BackendDisplay-cancel'></div>").append("<div class='pinion-backend-icon-close'></div>").append("<div class='pinion-backend-BackendDisplay-cancelText'>cancel</div>").click(function(){$closeButton.click()}).appendTo($staticBottomContainer);$("<div class='pinion-backend-BackendDisplay-infoarea'></div>").appendTo($staticBottomContainer);pinion.drag.connections={};this.identifier="BackendDisplay_"+backend.name;this.elements[this.identifier]=this;this.settings=$.extend(true,{},this.globalElementSettings);this.backend=this;this.info=this.settings.info;this.parent=null;this.children=[];this._isDirty=false;this._isChanged=false;this._isValid=null;this.addElements(elements,this);var tabsLeft=this.tabs.left;length=tabsLeft.length;if(length>0){var $tabsLeft=jQuery("<ul id='pinion-backend-tabs-left'></ul>").appendTo($outerContainer);this.$tabsLeft=$tabsLeft;var $tabOverlapHelper=$("<div class='pinion-backend-BackendDisplay-tabOverlapHelper'></div>");for(i=0;i<length;i++){var tab=tabsLeft[i];var $li=$("<li data-title='"+tab.title.toLowerCase()+"'>"+pinion.translate(tab.title)+"</li>").click({element:tab.element,$element:tab.element.$element},function(event){var $this=$(this);if(!$this.hasClass("active"))event.data.element.fire("openTab");$this.addClass("active").siblings().removeClass("active");event.data.$element.show().siblings(".pinion-backend-tab").hide();$tabOverlapHelper.css("top",$this.parent().position().top+$this.position().top+1)}).mouseenter(function(){if(pinion.drag.active){$(this).click();$(".pinion-draggable").sortable("refresh").sortable("refreshPositions")}}).append(new pinion.Resetter(tab.element)).appendTo($tabsLeft);tab.element.$tab=$li};$tabOverlapHelper.height($li.height()).appendTo($outerContainer);if(info.tab)$tabsLeft.children("[data-title='"+info.tab+"']").click();else $tabsLeft.children(":first").click()};this.leftPosition=($tabsLeft?$tabsLeft.width():0)+40;$("<div class='pinion-whiteGradient'></div>").appendTo($staticBottomContainer)};pinion.inherit(constr,pinion.backend.ElementBase);constr.prototype.addTab=function(position,title,element){this.tabs[position].push({title:title,element:element})};constr.prototype.openTab=function(title){this.$tabsLeft.children("[data-title='"+title.toLowerCase()+"']").click()};return constr}(jQuery));jQuery(function($){new pinion.Frontend().init()});pinion.Frontend=(function($){var constr,phpContents=pinion.php.content,_this,inizializeChildren=function(elem){for(var i=0,length=elem.children.length;i<length;i++){var child=elem.children[i];inizializeChildren(child);if(child.init instanceof Function)child.init();if(child.$warning)child.$warning.hide()}};constr=function(){_this=this;this.contents={};var loader,$iconSave=$("<div class='pinion-backend-icon-save'></div>"),$saveButton=$("<div id='pinion-Frontend-saveButton'></div>").append($iconSave).append("<span class='pinion-Frontend-saveText'>"+pinion.translate("save")+"</span>").click(function(){if(_this.deletePage!==undefined){loader=new pinion.Loader("darkblue");$saveButton.addClass("pinion-loading");$iconSave.append(loader.$element);pinion.ajax({module:"page",event:"deletePage",info:{id:_this.deletePage}},function(){_this.setClean();$saveButton.removeClass("pinion-loading");loader.remove()});return};var dirtyElements=_this.dirtyElements;if(!pinion.isEmpty(dirtyElements)){pinion.ajax.collect=true;for(var module in dirtyElements){var dirtyElement=dirtyElements[module];if(!dirtyElement._isDeleted&&dirtyElement.saveClick instanceof Function)_this.dirtyElements[module].saveClick()};loader=new pinion.Loader("darkblue");$saveButton.addClass("pinion-loading");$iconSave.append(loader.$element);_this.one("clean",function(){$saveButton.removeClass("pinion-loading");loader.remove()})}});this.$element=$("<div id='pinion-Frontend-saveButtonWrapper'></div>").append("<div class='pinion-dragHandle'></div>").append($saveButton).append("<div class='pinion-dragHandle'></div>").append(new pinion.Resetter(this)).draggable({handle:".pinion-dragHandle",axis:"x",containment:"parent"}).css("position","").appendTo("body");pinion.Frontend.instance=_this};constr.getClassName=function(moduleName){var className=moduleName.substr(0,1).toUpperCase()+moduleName.substr(1);if(!(pinion.backend.module[className] instanceof Function))className="defaultModule";return className};constr.getModuleElement=function(moduleName,settings,$html,isNew){if(settings===undefined)settings={};if($html.is("a"))$html.click(function(){return false});var className=constr.getClassName(moduleName);_this.doInitialization=false;var module=_this.addElement($.extend({type:"module",moduleName:moduleName,name:className,content:{visible:false},data:{},vars:{},_isNew:(isNew===true)},settings));module._isDeleted=false;_this.doInitialization=true;module.$contentElement=$html.first();pinion.Module.modulize(module);module.$contentElement.append(module.$element);module.$contentElement.data("element",module);$.extend(pinion.backend.module[className].prototype,pinion.backend.ElementBase.prototype);if(module.settings.content.id!==undefined)_this.contents[module.settings.content.id]=module;pinion.fire("createModule",module);return module};constr.getContent=function(id){return _this.contents[id]};pinion.inherit(constr,pinion.backend.ElementBase);$.extend(constr.prototype,pinion.EventDispatcher.prototype);constr.prototype.init=function(){var _this=this;this.handlers={};this.name="FrontendDisplay";this.dirtyElements={};this.validations={};this.elements={};this.identifier=this.name;this.elements[this.identifier]=this;this.settings=$.extend(true,{},this.globalElementSettings);this.backend=this;this.info=this.settings.info;this.parent=null;this.children=[];this._isDirty=false;this._isChanged=false;this._isValid=null;$(".cms").each(function(){var $this=$(this),classes=$this.attr("class"),matches=classes.match(/cms-(\d*)-([0-9A-Za-z_-]*)-([0-9A-Za-z_-]*)-(\d*)/);if(matches){var contentId=matches[1],areaName=matches[2],moduleName=matches[3],moduleId=matches[4],content=pinion.php.content[contentId];content.html=$('<div>').append($this.clone()).remove().html();var module=constr.getModuleElement(moduleName,{moduleId:moduleId,contentId:contentId,content:content.content,data:content.data,vars:content.vars},$this)}else{matches=classes.match(/cms-area-([0-9A-Za-z_-]*)/);if(matches){var areaName=matches[1],$placeholder=$this;new pinion.frontend.AreaPlaceholder($placeholder,areaName);pinion.fire("createArea",{area:areaName,$placeholder:$placeholder})}}});pinion.fire("frontendDone")};constr.replaceContent=function(id,html,identifier){var oldElement;if(identifier===undefined)oldElement=constr.getContent(id);else oldElement=_this.elements[identifier];if(oldElement===undefined)return false;var $contentElement=oldElement.$contentElement,$newElementContent=$(html);_this.removeElement(oldElement);$contentElement.after($newElementContent).remove();var phpContent=phpContents[id];var newElement=pinion.Frontend.getModuleElement(oldElement.settings.moduleName,{moduleId:phpContent.content.moduleid,contentId:id,content:phpContent.content,data:phpContent.data,vars:phpContent.vars},$newElementContent.first());return newElement};constr.removeContent=function(id){var element=constr.getContent(id),$contentElement;if(element){$contentElement=element.$contentElement;_this.removeElement(element);$contentElement.remove()}};return constr}(jQuery));pinion.namespace("frontend");pinion.frontend.AreaPlaceholder=(function($){var constr,FrontendBox=pinion.FrontendBox;constr=function($content,area){this.content={areaname:area};$content.data("element",this);var $add=jQuery("<div class='pinion-backend-icon-add'></div>").click(function(){var $add=$(this);if($add.hasClass("pinion-active"))FrontendBox.hide();else{$add.addClass("pinion-active");FrontendBox.show($add,pinion.frontend.$moduleMenu,{steps:80})}}),$addWrapper=$("<div class='pinion-frontend-AreaPlaceholder'></div>").append($add).appendTo($content);pinion.registerHelp($add,"Add a new content")};constr.prototype={constructor:pinion.frontend.AreaPlaceholder};return constr}(jQuery));pinion.frontend.$moduleMenu=(function($){var modules=pinion.php.modules,$ul=$("<ul class='pinion-FrontendBox-modulelist'></ul>");$(function(){for(var i in modules){var module=modules[i];if(module.isFrontend&&pinion.hasPermission(i,"add")){var $moduleBefore=$("<div class='pinion-addModule-before'><span class='pinion-frontend-menu-icon-arrow'></span></div>").click((function(){var name=i;return function(){pinion.fire("addModule",{name:name,mode:"before"})}}())),$moduleAfter=$("<div class='pinion-addModule-after'><span class='pinion-frontend-menu-icon-arrow'></span></div>").click((function(){var name=i;return function(){pinion.fire("addModule",{name:name,mode:"after"})}}())),$icon=$("<span class='icon'><img src='"+module.icon+"' /></span>").append($moduleBefore).append($moduleAfter),$a=$("<a></a>").append($icon).append("<span class='text'>"+pinion.translate(module.title)+"</span>").textRunner();$("<li></li>").append($a).appendTo($ul)}}});return $ul}(jQuery));pinion.frontend.RevisionList=(function($){var currentModule,currentId,$revisionList=$("<ul class='pinion-frontend-revisions'></ul>").on("click","a",function(){pinion.FrontendBox.hide();pinion.ajax({module:"page",event:"changeRevision",info:{id:currentId,module:currentModule,revision:$(this).attr("data-id")}})}),show=function(moduleName,moduleId){pinion.FrontendBox.showLoader();currentModule=moduleName;currentId=moduleId;$revisionList.html("");pinion.ajax({module:"page",event:"revisions",info:{module:currentModule,id:currentId}},function(data){pinion.FrontendBox.hideLoader();build(data.revisions)});return $revisionList.show()},hide=function(){return $revisionList.hide()},build=function(revisions){for(var i=revisions.length;i--;){var revision=revisions[i],date=new Date(revision.created*1000),addZeros=function(num,length){num=num.toString();var numLength=num.length,diff=length-numLength;while(diff--)num="0"+num;return num},day=addZeros(date.getDate(),2),month=addZeros(date.getMonth(),2),year=date.getFullYear(),hours=addZeros(date.getHours(),2),minutes=addZeros(date.getMinutes(),2),$li=$("<li></li>"),$a=$("<a data-id='"+revision.revision+"'></a>").appendTo($li);$("<div class='pinion-numberBox'></div>").append(pinion.numberize(revision.revision)).appendTo($a);$("<span class='pinion-date'>"+day+"."+month+"."+year+"</span>").appendTo($a);$("<span class='pinion-time'>"+hours+":"+minutes+"</span>").appendTo($a);$li.appendTo($revisionList)};pinion.FrontendBox.update()};return {show:show,hide:hide}}(jQuery));pinion.frontend.StyleList=(function($){var currentModule,$styleList=$("<ul class='pinion-frontend-stylelist'></ul>").on("click","a",function(){var content=currentModule.content;pinion.FrontendBox.hide();pinion.ajax({module:"page",event:"changeStyle",info:{id:content.id,template:$(this).attr("data-name")}})}),show=function(module){pinion.FrontendBox.showLoader();currentModule=module;$styleList.html("");pinion.ajax({module:"page",event:"getStyles",info:{module:currentModule.content.module,id:currentModule.content.moduleid}},function(data){pinion.FrontendBox.hideLoader();build(data.data)});return $styleList.show()},hide=function(){return $styleList.hide()},build=function(styles){for(var i=0,length=styles.length;i<length;i++){var style=styles[i],styleName=style.name,styleIcon=style.icon,$li=$("<li></li>"),$numberBox=$("<div class='pinion-numberBox'></div>").append(pinion.numberize(i+1,13));var $styleIcon=$("<div class='pinion-style-icon'></div>");if(styleIcon)$styleIcon.css("background-image","url("+styleIcon+")");$("<a data-name='"+styleName+"'></a>").append($numberBox).append($styleIcon).append("<span class='text'>"+styleName+"</span>").textRunner().appendTo($li);$li.appendTo($styleList)};pinion.FrontendBox.update()};return {show:show,hide:hide}}(jQuery));pinion.frontend.ContentList=(function($){var currentModule,$styleList=$("<ul class='pinion-frontend-contentlist'></ul>").on("click","li.pinion-frontend-content",function(){pinion.ajax({module:"page",event:"changeContent",info:{identifier:currentModule.identifier,areaname:currentModule.content.areaname,id:$(this).attr("data-id"),oldId:(currentModule.settings.moduleId!==undefined)?currentModule.settings.moduleId:undefined,module:currentModule.name}});pinion.FrontendBox.hide()}),show=function(module){pinion.FrontendBox.showLoader();currentModule=module;$styleList.html("");pinion.ajax({module:currentModule.name,event:"getContents",info:{}},function(data){pinion.FrontendBox.hideLoader();build(data.data)});return $styleList.show()},hide=function(){return $styleList.hide()},build=function(contents){var length=contents.length;if(length){for(var i=0;i<length;i++){var content=contents[i],$numberBox=$("<div class='pinion-numberBox'></div>").append(pinion.numberize(content.id,13)),$li=$("<li class='pinion-frontend-content' data-id='"+content.id+"'></li>").append($numberBox);pinion.preview(currentModule.name,content).appendTo($li);$li.appendTo($styleList)};pinion.FrontendBox.update()}else{pinion.FrontendBox.update();$styleList.hide().after("<div class='pinion-noContent'><div class='pinion-icon'></div><div class='pinion-text'>"+pinion.translate("no contents")+"</div></div>")}};return {show:show,hide:hide}}(jQuery));pinion.namespace("backend.group");pinion.backend.plugins.singleDirty=function(){var children=this.children;for(var i=children.length;i--;)children[i].on("dirty",function(){var siblings=this.siblings();for(var j=siblings.length;j--;)siblings[j].resetElement()})};pinion.backend.group.MainTab=(function($){var constr;constr=function(settings,backend){this.settings=settings;this.$element=$("<div class='pinion-backend-tab'></div>");backend.addTab("left",settings.title,this)};constr.prototype={constructor:pinion.backend.group.MainTab,init:function(){this.on("dirty",function(){this.$tab.addClass("dirty")}).on("clean",function(){this.$tab.removeClass("dirty")}).on("invalid",function(){this.$tab.addClass("invalid")}).on("valid",function(){this.$tab.removeClass("invalid")})}};return constr}(jQuery));pinion.backend.group.LazyMainTab=(function($){var constr;constr=function(settings,backend){this.settings=settings;this.$element=$("<div class='pinion-backend-tab'></div>");backend.addTab("left",settings.title,this);this.elements=[];this.hasLoaded=false;this.backendOpen=false;this.tabClicked=false};pinion.inherit(constr,pinion.backend.group.MainTab);constr.prototype.init=function(){constr.uber.init.call(this);this.on("openTab",function(){this.tabClicked=true;if(this.backendOpen)this.start()});this.backend.on("open",function(){this.backendOpen=true;if(this.tabClicked)this.start()},this)};constr.prototype.start=function(){this.backend.addElements(this.elements,this);this.backend.off("open",this);this.off("openTab")};return constr}(jQuery));pinion.backend.group.TabGroup=(function($){var constr;constr=function(settings,backend){this.$tabTitles=$("<ul class='pinion-backend-group-TabGroup-titles'></ul>");this.$childrenContainer=$("<div class='pinion-backend-group-TabGroup-tabs'></div>");this.$element=$("<div class='pinion-backend-group-TabGroup'></div>").append(this.$childrenContainer)};constr.prototype={constructor:pinion.backend.group.TabGroup,defaultSettings:{tabPosition:"top"},init:function(){var _this=this,first=true;for(var i=0,length=this.children.length;i<length;i++){var child=this.children[i];if(child instanceof pinion.backend.group.TitledSection){this.addToGroup(child,first);first=false}};this.on("childAdded",function(data){this.addToGroup(data.element,true)});if(this.settings.tabPosition=="bottom")this.$element.append(this.$tabTitles);else this.$element.prepend(this.$tabTitles)},addToGroup:function(element,show){var _this=this;var $li=$("<li></li>").append(element.$h2).appendTo(this.$tabTitles).click({$element:element.$element.hide()},function(event){var $this=$(this);_this.fire("changeContent",{headline:$this.text()});$this.addClass("active").siblings().removeClass("active");event.data.$element.show().siblings(".pinion-backend-group-TitledSection").hide()});if(show)$li.click()}};return constr}(jQuery));pinion.backend.group.LazyTabGroup=(function($){var constr;constr=function(settings,backend){this.settings=settings;this.$tabTitles=$("<ul class='pinion-backend-group-TabGroup-titles'></ul>");this.$childrenContainer=$("<div class='pinion-backend-group-TabGroup-tabs'></div>");this.$element=$("<div class='pinion-backend-group-TabGroup'></div>").append(this.$tabTitles).append(this.$childrenContainer);this.elements=[];this.tabElements={};this.loadedTabs={}};pinion.inherit(constr,pinion.backend.group.TabGroup);constr.prototype.init=function(){var _this=this;this.findChildren();if(!pinion.isEmpty(this.tabElements))this.loadTab(0);constr.uber.init.call(this);this.$tabTitles.children().each(function(index){$(this).click({index:index},function(event){_this.loadTab(event.data.index)})})};constr.prototype.findChildren=function(){var elements=this.elements,element,index=-1,identifier=this.identifier,tabElements={};for(var i=0,length=elements.length;i<length;i++){element=elements[i];if(element.parent==identifier){element=this.addChild(element);index++;tabElements["tab_"+index]=[]}else tabElements["tab_"+index].push(element)};this.tabElements=tabElements};constr.prototype.loadTab=function(index){if(this.loadedTabs["tab_"+index]===undefined){this.loadedTabs["tab_"+index]=true;this.backend.addElements(this.tabElements["tab_"+index],this.children[index])}};return constr}(jQuery));pinion.backend.group.SelectGroup=(function($){var constr;constr=function(settings,backend){var $selectTitlesWrapper=$("<div class='pinion-backend-group-SelectGroup-titles'></div>");this.addLabel(settings,$selectTitlesWrapper);this.$selectTitles=$("<select></select>").appendTo($selectTitlesWrapper);this.$childrenContainer=$("<div class='pinion-backend-group-SelectGroup-tabs'></div>");this.$element=$("<div class='pinion-backend-group-SelectGroup'></div>").append($selectTitlesWrapper).append(this.$childrenContainer)};constr.prototype={constructor:pinion.backend.group.SelectGroup,defaultSettings:{translate:true},addLabel:function(settings,$to){if(settings.label){var label=settings.translate?pinion.translate(settings.label):settings.label;$to.append("<div class='pinion-label'>"+label+"</div>")}},init:function(){var _this=this,first=true;this.$selectTitles.change(function(){var $selected=$(this).children(":selected");_this.fire("changeContent",{headline:$selected.val()});$selected.data("$selectElement").show().siblings(".pinion-backend-group-TitledSection").hide()});for(var i=0,length=this.children.length;i<length;i++){var child=this.children[i];if(child instanceof pinion.backend.group.TitledSection){this.addToGroup(child,first);first=false}};this.on("childAdded",function(data){this.addToGroup(data.element,true)})},addToGroup:function(element,show){if(element instanceof pinion.backend.group.TitledSection){var $option=$("<option></option>").text(element.$h2.hide().text()).attr("selected",!!show).appendTo(this.$selectTitles).data("$selectElement",element.$element.hide());if(show)this.$selectTitles.change()}}};return constr}(jQuery));pinion.backend.group.LazySelectGroup=(function($){var constr,LazyTabGroup=pinion.backend.group.LazyTabGroup.prototype;constr=function(settings,backend){this.settings=settings;var $selectTitlesWrapper=$("<div class='pinion-backend-group-SelectGroup-titles'>");this.addLabel(settings,$selectTitlesWrapper);this.$selectTitles=$("<select></select>").appendTo($selectTitlesWrapper);this.$childrenContainer=$("<div class='pinion-backend-group-SelectGroup-tabs'></div>");this.$element=$("<div class='pinion-backend-group-SelectGroup'></div>").append($selectTitlesWrapper).append(this.$childrenContainer);this.elements=[];this.tabElements={};this.loadedTabs={}};pinion.inherit(constr,pinion.backend.group.SelectGroup);constr.prototype.init=function(){var _this=this;LazyTabGroup.findChildren.call(this);if(!pinion.isEmpty(this.tabElements))LazyTabGroup.loadTab.call(this,0);constr.uber.init.call(this);this.$selectTitles.change(function(){LazyTabGroup.loadTab.call(_this,$(this).children(":selected").index())})};return constr}(jQuery));pinion.backend.group.Accordion=(function($){var constr;constr=function(settings,backend){this.$element=$("<div class='pinion-backend-group-Accordion'></div>")};constr.prototype={constructor:pinion.backend.group.Accordion,init:function(){var first=true;for(var i=0,length=this.children.length;i<length;i++){var child=this.children[i];if(child instanceof pinion.backend.group.TitledGroup){if(!first)child.close();else{child.$element.addClass("active");first=false};child.$h2.click(function(){var $this=$(this);var $parent=$this.parent();if(!$parent.hasClass("active"))$parent.addClass("active").siblings(".pinion-backend-group-TitledGroup").filter(function(){return $(this).data("open")}).children("h2").click().end().removeClass("active")})}}}};return constr}(jQuery));pinion.backend.group.LazyAccordion=(function($){var constr,LazyTabGroup=pinion.backend.group.LazyTabGroup.prototype;constr=function(settings,backend){this.$element=$("<div class='pinion-backend-group-Accordion'></div>");this.elements=[];this.tabElements={};this.loadedTabs={}};pinion.inherit(constr,pinion.backend.group.Accordion);constr.prototype.init=function(){var _this=this;LazyTabGroup.findChildren.call(this);LazyTabGroup.loadTab.call(this,0);constr.uber.init.call(this);var children=this.children;for(var i=0,length=children.length;i<length;i++)children[i].$element.click({index:i},function(event){LazyTabGroup.loadTab.call(_this,event.data.index)})};return constr}(jQuery));pinion.backend.group.TitledSection=(function($){var constr;constr=function(settings){this.build(settings)};constr.prototype={constructor:pinion.backend.group.TitledSection,defaultSettings:{translate:true},build:function(settings){if(settings.title==null||settings.title==undefined)settings.title="";else if(settings.translate)settings.title=pinion.translate(settings.title.toString());this.$h2=$("<h2><span class='pinion-text'>"+settings.title+"</span></h2>");this.$element=$("<div class='pinion-backend-group-TitledSection'></div>").append(this.$h2);this.$childrenContainer=$("<div></div>").appendTo(this.$element)},init:function(){this.$dirtyFlag.appendTo(this.$h2)}};return constr}(jQuery));pinion.backend.group.Section=(function($){var constr;constr=function(settings){this.$element=$("<div class='pinion-backend-group-Section'></div>")};constr.prototype={constructor:pinion.backend.group.Section,init:function(){}};return constr}(jQuery));pinion.backend.group.Wrapper=(function($){var constr;constr=function(settings){this.$element=settings.$element};constr.prototype={constructor:pinion.backend.group.Wrapper,init:function(){this.$dirtyFlag.remove()}};return constr}(jQuery));pinion.backend.group.TitledGroup=(function($){var constr;constr=function(settings){this.build(settings)};constr.prototype={constructor:pinion.backend.group.TitledGroup,defaultSettings:{speed:500,open:true,translate:true},build:function(settings){var _this=this;this.$element=$("<div class='pinion-backend-group-TitledGroup expanded'></div>").data("open",true);this.$iconSpan=$("<span class='pinion-backend-icon-arrowDown-darkBlue'></span>").hover(function(){var $this=$(this);if(_this.$element.hasClass("expanded"))$this.attr("class","pinion-backend-icon-arrowRight-darkBlue");else $this.attr("class","pinion-backend-icon-arrowDown-darkBlue");$this.addClass("pinion-opacity50")},function(){var $this=$(this);if(_this.$element.hasClass("expanded"))$this.attr("class","pinion-backend-icon-arrowDown-darkBlue");else $this.attr("class","pinion-backend-icon-arrowRight-darkBlue");$this.removeClass("pinion-opacity50")});settings.title=settings.translate?pinion.translate(settings.title):settings.title;this.$h2=$("<h2><span class='pinion-text'>"+settings.title+"</span></h2>").click(function(){_this.open()}).prepend(this.$iconSpan).appendTo(this.$element);this.$childrenContainer=$("<div></div>").appendTo(this.$element)},init:function(){this.$dirtyFlag.appendTo(this.$h2);if(!this.settings.open)this.close()},open:function(){var _this=this,$h2=this.$h2,$next=$h2.next();if(this.$element.data("open")){this.$element.data("open",false);$next.slideUp(this.settings.speed,function(){_this.$element.removeClass("expanded");_this.$iconSpan.attr("class","pinion-backend-icon-arrowRight-darkBlue")})}else{this.$element.addClass("expanded").data("open",true);this.$iconSpan.attr("class","pinion-backend-icon-arrowDown-darkBlue");$next.slideDown(this.settings.speed)}},close:function(){this.$element.removeClass("expanded").data("open",false);this.$childrenContainer.hide();this.$iconSpan.attr("class","pinion-backend-icon-arrowRight-darkBlue")}};return constr}(jQuery));pinion.backend.group.LazyTitledGroup=(function(){var constr;constr=function(settings){settings.open=false;this.build(settings);this.hasLoaded=false;this.elements=[]};pinion.inherit(constr,pinion.backend.group.TitledGroup);constr.prototype.open=function(){if(!this.hasLoaded){this.hasLoaded=true;this.backend.addElements(this.elements,this)};constr.uber.open.call(this)};return constr}());pinion.backend.group.ColumnGroup=(function($){var constr;constr=function(settings){this.$element=$("<div class='pinion-backend-group-ColumnGroup'></div>")};constr.prototype={constructor:pinion.backend.group.ColumnGroup,defaultSettings:{splitting:[]},init:function(){var numChildren=this.children.length;var splitting=this.settings.splitting;if(!Array.isArray(splitting))splitting=this.settings.splitting.split(",");var splittingLength=splitting.length;var splittingAddition=0;for(var i=0;i<numChildren;i++){if(splittingLength>i)splitting[i]=parseFloat(splitting[i],10);else splitting[i]=1;splittingAddition+=splitting[i]};for(i=0;i<numChildren;i++)$("<div class='pinion-backend-group-ColumnGroup-columnWrapper'></div>").width(Math.floor(100*splitting[i]/splittingAddition)+"%").append(this.children[i].$element).appendTo(this.$element)}};return constr}(jQuery));pinion.backend.group.StepGroup=(function($){var constr;constr=function(settings,backend){this.$tabTitle=$("<div class='pinion-backend-group-StepGroup-title'></div>");this.$childrenContainer=$("<div class='pinion-backend-group-StepGroup-steps'></div>");this.$element=$("<div class='pinion-backend-group-StepGroup'></div>").append(this.$childrenContainer);this.steps=[];this.$stepCount=$("<span class='pinion-step-count'>/0</span>");this.$toRight=$("<div class='pinion-backend-icon-arrowRight'></div>")};constr.prototype={constructor:pinion.backend.group.StepGroup,defaultSettings:{tabPosition:"top"},init:function(){var children=this.children,length=children.length;for(var i=0;i<length;i++){var child=children[i];this.addToGroup(child,(i==length-1))};this.on("childAdded",function(data){this.addToGroup(data.element,true)})},addToGroup:function(element,update){var steps=this.steps;steps.push({$number:pinion.numberize(steps.length+1,13),$h2:element.$h2.detach(),$content:element.$element.hide()});this.$stepCount.text("/"+steps.length);if(steps.length>1)this.$toRight.show();if(steps.length==1){element.$element.show();var _this=this,currentStep=0,$toLeft,$toRight=this.$toRight,$stepNumber,$numberBox,$tabTitle=this.$tabTitle;$numberBox=$("<div class='pinion-numberBox'></div>").append(steps[currentStep].$number);$stepNumber=$("<div class='pinion-step-number'></div>").append($numberBox).append(this.$stepCount);$toLeft=$("<div class='pinion-backend-icon-arrowLeft'></div>").click(function(){if(currentStep==steps.length-1)$toRight.show();steps[currentStep].$h2.detach();steps[currentStep].$number.detach();steps[currentStep].$content.hide();currentStep--;_this.fire("changeContent",{headline:steps[currentStep].$h2.text()});if(currentStep==0)$toLeft.hide();steps[currentStep].$h2.appendTo($tabTitle);steps[currentStep].$number.appendTo($numberBox);steps[currentStep].$content.show();_this.$tabTitleClone.remove();_this.$tabTitleClone=$tabTitle.clone(true).appendTo(_this.$element)}).hide();$toRight.click(function(){if(currentStep==0)$toLeft.show();steps[currentStep].$h2.detach();steps[currentStep].$number.detach();steps[currentStep].$content.hide();currentStep++;_this.fire("changeContent",{headline:steps[currentStep].$h2.text()});if(currentStep==steps.length-1)$toRight.hide();steps[currentStep].$h2.appendTo($tabTitle);steps[currentStep].$number.appendTo($numberBox);steps[currentStep].$content.show();_this.$tabTitleClone.remove();_this.$tabTitleClone=$tabTitle.clone(true).appendTo(_this.$element)}).hide();$tabTitle.append($toLeft).append($toRight).append($stepNumber).append(steps[currentStep].$h2);this.$tabTitleClone=$tabTitle.clone(true).appendTo(_this.$element);if(this.settings.tabPosition=="bottom")this.$element.append($tabTitle);else this.$element.prepend($tabTitle)};if(update){this.$tabTitleClone.remove();this.$tabTitleClone=this.$tabTitle.clone(true).appendTo(this.$element)}}};return constr}(jQuery));pinion.namespace("backend.html");pinion.backend.html.SimpleHtml=(function($){var constr;constr=function(settings){this.$element=$("<div class='pinion-backend-html-SimpleHtml'>"+settings.html+"</div>")};constr.prototype={constructor:pinion.backend.html.SimpleHtml};return constr}(jQuery));pinion.backend.html.IFrame=(function($){var constr;constr=function(settings){var width=settings.width?" width='"+settings.width+"'":"",height=settings.height?" height='"+settings.height+"'":"";this.$element=$("<iframe src='"+settings.src+"' class='pinion-backend-html-IFrame'"+width+height+"></iframe>")};constr.prototype={constructor:pinion.backend.html.IFrame,defaultSettings:{src:null,width:"100%",height:"100%"}};return constr}(jQuery));pinion.namespace("backend.input");pinion.backend.input.Textbox=(function($){var constr;constr=function(settings){this.build(settings);this.labelAsInfoKey(settings)};constr.prototype={constructor:pinion.backend.input.Textbox,defaultSettings:{value:"",password:false,bigger:false},build:function(settings){this.$element=$("<div class='pinion-backend-input-Textbox'></div>");if(settings.bigger)this.$element.addClass("pinion-biggerInput");settings.value=settings.value==null?"":settings.value;this.$input=$("<input type='"+(settings.password?"password":"text")+"' value='"+settings.value+"'></input>");this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;if(settings.value==null||settings.value==undefined)settings.value=""},labelAsInfoKey:function(settings){if(settings.infoKey===undefined){if(settings.label!="")settings.infoKey=settings.label;else settings.infoKey="value"}},init:function(){var _this=this,settings=this.settings,dirty=settings.dirty;if(this.settings.label)this.$label=$("<label class='pinion-label'>"+pinion.translate(this.settings.label)+"</label>").prependTo(this.$element);this.$input.keyup(function(event){if(event.which==9)return;var myTime=new Date().getTime();_this.time=myTime;setTimeout(function(){if(myTime==_this.time){var val=_this.$input.val();_this.settings.value=val;_this.info[_this.settings.infoKey]=val;if(val!==_this.initSettings.value)_this.setDirty();else _this.setClean()}},500)}).appendTo(this.$inputWrapper);this.$dirtyFlag.appendTo(this.$element);this.$warning=$("<div class='pinion-backend-warning'></div>").appendTo(this.$inputWrapper);if(this.settings.validators.notEmpty!==undefined)this.$element.addClass("required");if(this.validators.sameAs!==undefined){var compareElement=this.backend.elements[this.validators.sameAs];compareElement.on("change",function(){_this.validate()})}},val:function(text){var $input=this.$input;if(text===undefined)return $input.val();else{$input.val(text).keyup();return this}},validate:function(value){var _this=this;if(value===undefined)value=this.$input.val();if(this.validators.notEmpty!==undefined){if($.trim(value)==="")return this.setInvalid("This field is required")};if(this.validators.file!==undefined){if(!/^[\w]+$/.test(value))return this.setInvalid("This field only accept the characters [0-9A-Za-z_]")};if(this.validators.email!==undefined){if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(value))return this.setInvalid("This field must contain a valid email-address")};if(this.validators.minChars!==undefined){if(value.length<this.validators.minChars)return this.setInvalid("This field must contain "+this.validators.minChars+" chars at minimum")};if(this.validators.maxChars!==undefined){if(value.length>this.validators.minChars)return this.setInvalid("This field may contain "+this.validators.minChars+" chars at maximum")};if(this.validators.onlyNumbers!==undefined){if(!/^\d*$/.test(value))return this.setInvalid("This field only takes numbers")};if(this.validators.sameAs!==undefined){var compareElement=this.backend.elements[this.validators.sameAs];if(compareElement.$input.val()!=value)return this.setInvalid("This field don't match with '"+compareElement.settings.label+"'")};if(this.validators.events!==undefined){pinion.ajax(pinion.addInfo(this.validators.events,this.info),function(data){if(data.valid!==true)return _this.setInvalid(data.valid);return _this.setValid()})}else return this.setValid()},reset:function(){this.$input.val(this.initSettings.value)}};return constr}(jQuery));pinion.backend.input.AutoCompleteTextbox=(function($){var constr;constr=function(settings){this.build(settings);this.labelAsInfoKey(settings)};pinion.inherit(constr,pinion.backend.input.Textbox);constr.prototype.defaultSettings={value:"",data:[],bigger:false};constr.prototype.init=function(){constr.uber.init.call(this);this.addAutoComplete()};constr.prototype.addAutoComplete=function(){var _this=this;if(!Array.isArray(this.settings.data))pinion.ajax(this.settings.data,function(data){_this.settings.data=data.data;_this.initSettings.data=data.data;_this.$input.autocomplete({appendTo:_this.backend.$element,source:_this.settings.data})});else _this.$input.autocomplete({appendTo:_this.backend.$element,source:_this.settings.data})};return constr}(jQuery));pinion.backend.input.TranslationTextbox=(function($){var constr,supportedLanguages=pinion.php.supportedLanguages,mainLanguage=supportedLanguages[0],Textbox=pinion.backend.input.Textbox.prototype;constr=function(settings){Textbox.build.call(this,settings);Textbox.labelAsInfoKey.call(this,settings);this.$element.removeClass("pinion-backend-input-Textbox").addClass("pinion-backend-input-TranslationTextbox")};constr.prototype={constructor:pinion.backend.input.TranslationTextbox,defaultSettings:{value:"",password:false,bigger:false},init:function(){if(this.settings.label)this.$label=$("<label class='pinion-label'>"+pinion.translate(this.settings.label)+"</label>").prependTo(this.$element);this.createEditor("Textbox");this.$warning=$("<div class='pinion-backend-warning'></div>").appendTo(this.$inputWrapper)},createEditor:function(name){var _this=this,settings=this.settings,value=settings.value,translated=false,editors=[];if(value&&typeof value==="object"){translated=true;value=settings.value=value.translations};this.info[settings.infoKey]=settings.value;var $ul=$("<ul></ul>").on("click","li",function(){var $this=$(this),lang=$this.attr("data-id");$this.toggleClass("pinion-active");if(editors[lang]===undefined){var value="";if(translated){if(settings.value[lang]!==undefined)value=settings.value[lang]}else if(lang==mainLanguage)value=settings.value;editors[lang]=_this.addChild({name:name,type:"input",language:lang,value:value}).on("dirty",function(){if(translated)settings.value[this.settings.language]=this.settings.value;else if(mainLanguage==this.settings.language)settings.value=this.settings.value;else{translated=true;var currentValue=settings.value;settings.value={};settings.value[mainLanguage]=currentValue;settings.value[this.settings.language]=this.settings.value};_this.info[settings.infoKey]=settings.value});editors[lang].$element.append("<div class='pinion-flag pinion-flag-"+lang+"'></div>")}else if($this.hasClass("pinion-active"))editors[lang].show();else editors[lang].hide()}).appendTo(this.$inputWrapper);for(var i=0,length=supportedLanguages.length;i<length;i++){var lang=supportedLanguages[i];$("<li data-id='"+lang+"'><div class='pinion-flag pinion-flag-"+lang+"'></div></li>").appendTo($ul)};$ul.children(":first").click()}};return constr}(jQuery));pinion.backend.input.Button=(function($){var constr;constr=function(settings){this.$element=$("<div class='pinion-backend-input-Button pinion-button'></div>");this._counter=0};constr.prototype={constructor:pinion.backend.input.Button,defaultSettings:{label:"send",click:null,translate:true},init:function(){var _this=this,label=this.settings.translate?pinion.translate(this.settings.label):this.settings.label;if(this.settings.click)this.click(this.settings.click);this.$button=$("<input type='submit' value='"+label+"' />").click(function(){_this.fire("click");return false}).appendTo(this.$element)},click:function(callback){if(callback===undefined){this.$button.click();return this}else return this.on("click",callback)},reset:function(){this._counter=0}};return constr}(jQuery));pinion.backend.input.Checkbox=(function($){var constr;constr=function(settings){this.$element=$("<div class='pinion-backend-input-Checkbox'></div>");if(settings.bigger)this.$element.addClass("pinion-biggerInput");this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;this._counter=0;if(settings.infoKey===undefined){if(settings.label!="")settings.infoKey=settings.label;else settings.infoKey="value"};if(settings.value)this.$element.addClass("pinion-selected")};constr.prototype={constructor:pinion.backend.input.Checkbox,defaultSettings:{value:false,description:null,bigger:false},init:function(){var _this=this;if(this.settings.label)this.$label=$("<label class='pinion-label'>"+pinion.translate(this.settings.label)+"</label>").prependTo(this.$element);$("<div class='pinion-checkbox'><div class='pinion-backend-icon-check'></div></div>").click(function(){_this._counter++;_this.$element.toggleClass("pinion-selected");var newValue=!_this.settings.value;_this.settings.value=newValue;_this.info[_this.settings.infoKey]=newValue;if(_this._counter%2==0)_this.setClean();else _this.setDirty()}).appendTo(this.$inputWrapper);if(this.settings.description)$("<div class='pinion-description'>"+this.settings.description+"</div>").appendTo(this.$inputWrapper);this.$warning=$("<div class='pinion-backend-warning'></div>").appendTo(this.$inputWrapper);this.$dirtyFlag.appendTo(this.$element)},reset:function(){this.$element.toggleClass("pinion-selected");this._counter=0}};return constr}(jQuery));pinion.backend.input.ColorPicker=(function($){var constr,url=pinion.php.url;constr=function(settings,backend){this.build(settings);this.labelAsInfoKey(settings)};pinion.inherit(constr,pinion.backend.input.Textbox);constr.prototype.defaultSettings={value:"#185859"};constr.prototype.init=function(){constr.uber.init.call(this);var _this=this;this.$input.hide();pinion.require([url+"pinion/js/colorpicker/colorpicker.js",url+"pinion/js/colorpicker/css/colorpicker.css"],function(){_this.$colorPicker=$("<div class='pinion-colorPicker'></div>").ColorPicker($.extend({flat:true,onChange:function(hsb,hex,rgb){_this.$input.val("#"+hex).keyup()}},_this.settings)).appendTo(_this.$inputWrapper);_this.reset()})};constr.prototype.reset=function(){var value=this.settings.value;if(value!=""&&value!=null)this.$colorPicker.ColorPickerSetColor(value)};return constr}(jQuery));pinion.backend.input.DatePicker=(function($){var constr;constr=function(settings,backend){this.build(settings);this.labelAsInfoKey(settings)};pinion.inherit(constr,pinion.backend.input.Textbox);constr.prototype.init=function(){constr.uber.init.call(this);var _this=this;this.$input.hide();this.$datePicker=$("<div class='pinion-datePicker'></div>").datepicker($.extend({dateFormat:"@",onSelect:function(dateText){var time=Math.round(dateText/1000);_this.$input.val(time).keyup()},defaultDate:this.settings.value==""?null:(parseInt(this.settings.value,10)*1000).toString()},_this.settings)).appendTo(this.$inputWrapper);if(!this.settings.label)this.$dirtyFlag.appendTo(this.$element)};constr.prototype.reset=function(){this.$datePicker.datepicker("setDate",this.settings.value==""?null:(parseInt(this.settings.value,10)*1000).toString())};return constr}(jQuery));pinion.backend.input.Editor=(function($){var constr,pageUrl=pinion.php.url,lang=pinion.php.lang;constr=function(settings){this.$element=$("<div class='pinion-backend-input-Editor'></div>");if(settings.bigger)this.$element.addClass("pinion-biggerInput");if(settings.label)this.$label=$("<label class='pinion-label'>"+settings.label+"</label>").appendTo(this.$element);this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;this.$editor=$("<textarea class=''></textarea>").appendTo(this.$inputWrapper)};constr.prototype={constructor:pinion.backend.input.Editor,defaultSettings:{value:"",infoKey:"value",CKOptions:{}},init:function(){var _this=this;pinion.require([pageUrl+"pinion/js/ckeditor/ckeditor.js",pageUrl+"pinion/js/ckeditor/adapters/jquery.js"],function(){_this.info[_this.settings.infoKey]=_this.settings.value;setTimeout(function(){_this.$editor.ckeditor(function(event){this.on("change",function(event){var myTime=new Date().getTime();_this.time=myTime;setTimeout(function(){if(myTime==_this.time){var val=_this.$editor.val();_this.settings.value=val;_this.info[_this.settings.infoKey]=val;if(val!==_this.initSettings.value)_this.setDirty();else _this.setClean()}},500)});this.setData(_this.settings.value)},$.extend({language:lang,baseHref:pageUrl,dialog_backgroundCoverColor:'#1A292B',dialog_backgroundCoverOpacity:0.7,startupFocus:true,width:"100%",resize_minWidth:300,scayt_autoStartup:true,scayt_uiTabs:'0,1,0',skin:'pinion',toolbar_Backend:[{name:'undo',items:['Undo','Redo']},{name:'scayt',items:['Scayt']},{name:'clipboard',items:['Cut','Copy','Paste','PasteText','PasteFromWord']},{name:'editing',items:['Find']},{name:'document',items:['Source']},'/',{name:'basicstyles',items:['Bold','Italic','Underline','Strike','Subscript','Superscript','-','RemoveFormat']},{name:'paragraph',items:['NumberedList','BulletedList','-','Blockquote']},{name:'insert',items:['SpecialChar','Table','HorizontalRule']},{name:'links',items:['Link']}],toolbar_Frontend:[{name:'undo',items:['Undo','Redo']},{name:'scayt',items:['Scayt']},{name:'clipboard',items:['Cut','Copy','Paste','PasteText','PasteFromWord']},{name:'editing',items:['Find']},{name:'tools',items:['Maximize']},{name:'document',items:['Source']},'/',{name:'basicstyles',items:['Bold','Italic','Underline','Strike','Subscript','Superscript','-','RemoveFormat']},{name:'paragraph',items:['NumberedList','BulletedList','-','Blockquote']},{name:'insert',items:['SpecialChar','Table','HorizontalRule']},{name:'links',items:['Link']}],toolbar:"Backend"},_this.settings.CKOptions))})});_this.backend.on("positionChanged",function(){this.$editor.val(this.info[this.settings.infoKey])},_this).on("remove",function(){this.$editor.ckeditorGet().destroy()},_this)},reset:function(){this.$editor.val(this.initSettings.value)}};return constr}(jQuery));pinion.backend.input.TranslationEditor=(function($){var constr,supportedLanguages=pinion.php.supportedLanguages,mainLanguage=supportedLanguages[0],TranslationTextbox=pinion.backend.input.TranslationTextbox.prototype;constr=function(settings){this.$element=$("<div class='pinion-backend-input-TranslationEditor'></div>");if(settings.bigger)this.$element.addClass("pinion-biggerInput");if(settings.label)this.$label=$("<label class='pinion-label'>"+settings.label+"</label>").appendTo(this.$element);this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element};constr.prototype={constructor:pinion.backend.input.TranslationEditor,defaultSettings:{value:"",infoKey:"value",bigger:false},init:function(){TranslationTextbox.createEditor.call(this,"Editor")}};return constr}(jQuery));pinion.backend.input.Radiobutton=(function($){var constr;constr=function(settings){this.$element=$("<div class='pinion-backend-input-Radiobutton'></div>");if(settings.bigger)this.$element.addClass("pinion-biggerInput");this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;if(settings.infoKey===undefined){if(settings.label!="")settings.infoKey=settings.label;else settings.infoKey="value"}};constr.prototype={constructor:pinion.backend.input.Radiobutton,defaultSettings:{data:[],value:null,idAsDescription:true,bigger:false},init:function(){var _this=this,settings=this.settings,data=settings.data;if(settings.label)this.$label=$("<label class='pinion-label'>"+pinion.translate(settings.label)+"</label>").prependTo(this.$element);var length=data.length;if(length>0){var description=null;if(settings.idAsDescription)description="id";for(var name in data[0]){if(name=="id")continue;description=name;break};for(var i=0;i<length;i++){var d=data[i];var $wrapper=$("<div></div>");var $radiobutton=$("<div class='pinion-radiobutton' data-id='"+d.id+"'><div class='pinion-backend-icon-check'></div></div>").click(function(){var $this=$(this);$this.parent().siblings().children(".pinion-radiobutton").removeClass("pinion-selected");$this.addClass("pinion-selected");var newValue=$this.attr("data-id");settings.value=newValue;_this.info[_this.settings.infoKey]=newValue;if(_this.initSettings.value!=newValue)_this.setDirty();else _this.setClean()}).appendTo($wrapper);if(settings.value==d.id)$radiobutton.addClass("pinion-selected");if(description)$("<div class='pinion-description'>"+d[description]+"</div>").appendTo($wrapper);$wrapper.appendTo(this.$inputWrapper)};this.$warning=$("<div class='pinion-backend-warning'></div>").appendTo(this.$inputWrapper);this.$dirtyFlag.appendTo(this.$element)}},reset:function(){this.$element.find(".pinion-radiobutton").removeClass("pinion-selected");if(this.settings.value)this.$element.find(".pinion-radiobutton[data-id='"+this.settings.value+"']")}};return constr}(jQuery));pinion.backend.input.RadioSwitcher=(function($){var constr,TextboxPrototype=pinion.backend.input.Textbox.prototype;constr=function(settings){this.$element=$("<div class='pinion-backend-input-Switcher pinion-button'></div>");TextboxPrototype.labelAsInfoKey(settings);this.$switcherList=$("<div class='pinion-backend-input-Switcher-switcherList'></div>").hover(function(){_this.hovered=true},function(){_this.hovered=false;setTimeout(function(){if(!_this.hovered)_this.$switcherList.detach()},250)});var _this=this,data=settings.data,length=data.length,translateValues=settings.translateValues;if(length>0){var description=null;if(settings.idAsDescription)description="id";if(settings.description)description=settings.description;else for(var name in data[0]){if(name=="id")continue;description=name;break};for(var i=0;i<length;i++){var d=data[i],desc=translateValues?pinion.translate(d[description]):d[description],$li=$("<li data-id='"+d.id+"'><input type='submit' value='"+desc+"' /></li>").click(function(){var $this=$(this);_this.info[_this.infoKey]=$this.attr("data-id");$this.addClass("pinion-active").siblings().removeClass("pinion-active")}).appendTo(this.$switcherList);if(i==0){_this.info={};_this.info[settings.infoKey]=d.id;$li.addClass("pinion-active pinion-first")};if(i==length-1)$li.addClass("pinion-last")}}};constr.prototype={constructor:pinion.backend.input.RadioSwitcher,defaultSettings:{idAsDescription:true,description:null,label:"switch",data:[],dataPosition:"left",translate:true,translateValues:true},init:function(){var _this=this,outerWidth=null,dataPosition=this.settings.dataPosition,label=this.settings.translate?pinion.translate(this.settings.label):this.settings.label;this.$button=$("<input type='submit' value='"+label+"' />").click(function(){if(_this.isDirty()){_this.$switcherList.detach();_this.setClean()}else{var offset=_this.$element.offset(),css={};if(dataPosition=="right")css={top:offset.top,left:"",right:pinion.$document.width()-offset.left};else{if(outerWidth==null)outerWidth=_this.$button.outerWidth();css={top:offset.top,left:offset.left+outerWidth,right:""}};_this.$switcherList.css(css).appendTo(pinion.$body);_this.setDirty()}}).hover(function(){_this.hovered=true;if(_this.isDirty())_this.$switcherList.appendTo(pinion.$body)},function(){_this.hovered=false;setTimeout(function(){if(!_this.hovered)_this.$switcherList.detach()},250)}).appendTo(this.$element);this.$dirtyFlag.appendTo(this.$element);this.on("remove",function(){_this.$switcherList.remove()})},reset:function(){}};return constr}(jQuery));pinion.backend.input.Slider=(function($){var constr,Textbox=pinion.backend.input.Textbox;constr=function(settings){this.$element=$("<div class='pinion-backend-input-Slider'></div>");if(settings.bigger)this.$element.addClass("pinion-biggerInput");if(settings.label)this.$label=$("<label class='pinion-label'>"+settings.label+"</label>").appendTo(this.$element);this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;this.$slider=$("<div class='pinion-slider'></div>").appendTo(this.$inputWrapper);this.$input=$("<input type='text' value='"+settings.value+"'/>").appendTo(this.$inputWrapper);Textbox.prototype.labelAsInfoKey(settings)};constr.prototype={constructor:pinion.backend.input.Slider,defaultSettings:{value:0},init:function(){var _this=this;this.$slider.slider(this.settings).bind("slide",function(event,ui){_this.$input.val(ui.value)}).bind("slidechange",function(event,ui){_this.settings.value=ui.value;if(ui.value!=_this.initSettings.value){_this.setDirty();_this.info[_this.settings.infoKey]=ui.value}else _this.setClean();_this.$input.val(ui.value)});this.$input.change(function(){var val=parseInt(_this.$input.val(),10);_this.$slider.slider("option","value",val).trigger("slideschange")})},val:function(){return this.$slider.val()},reset:function(){this.$slider.slider("option","value",this.settings.value)}};return constr}(jQuery));pinion.backend.input.Switcher=(function($){var constr,TextboxPrototype=pinion.backend.input.Textbox.prototype;constr=function(settings){this.$element=$("<div class='pinion-backend-input-Switcher pinion-button'></div>");TextboxPrototype.labelAsInfoKey(settings)};constr.prototype={constructor:pinion.backend.input.Switcher,defaultSettings:{label:"switch",click:null,translate:true},init:function(){var _this=this,label=this.settings.translate?pinion.translate(this.settings.label):this.settings.label;if(this.settings.click)this.click(this.settings.click);this.$button=$("<input type='submit' value='"+label+"' />").click(function(){if(_this.isDirty())_this.setClean();else _this.setDirty();_this.fire("click")}).appendTo(this.$element);this.$dirtyFlag.appendTo(this.$element);_this.info[_this.settings.infoKey]=true},click:function(callback){if(callback===undefined){this.$button.click();return this}else return this.on("click",callback)},reset:function(){}};return constr}(jQuery));pinion.backend.input.Textarea=(function($){var constr;constr=function(settings){this.$element=$("<div class='pinion-backend-input-Textarea'></div>");if(settings.bigger)this.$element.addClass("pinion-biggerInput");this.$input=$("<textarea>"+settings.value+"</textarea>");this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;if(settings.infoKey===undefined){if(settings.label!="")settings.infoKey=settings.label;else settings.infoKey="value"}};pinion.inherit(constr,pinion.backend.input.Textbox);return constr}(jQuery));pinion.backend.input.Codearea=(function($){var constr,url=pinion.php.url;constr=function(settings){this.$element=$("<div class='pinion-backend-input-Codearea'></div>");if(settings.bigger)this.$element.addClass("pinion-biggerInput");this.$input=$("<textarea>"+settings.value+"</textarea>");this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;if(settings.infoKey===undefined){if(settings.label!="")settings.infoKey=settings.label;else settings.infoKey="value"}};pinion.inherit(constr,pinion.backend.input.Textarea);constr.prototype.defaultSettings={value:"",mode:"php"};constr.prototype.init=function(){constr.uber.init.call(this);var _this=this,mode=this.settings.mode;if(mode=="php")this.settings.mode="text/x-php";pinion.require([url+"pinion/js/codemirror/lib/codemirror_pinion.css",url+"pinion/js/codemirror/lib/codemirror-compressed.js"],function(){_this.editor=CodeMirror.fromTextArea(_this.$input.get(0),$.extend({lineNumbers:true,matchBrackets:true,indentUnit:4,enterMode:"keep",tabMode:"shift",onUpdate:function(){if(_this.editor)_this.val(_this.editor.getValue())}},_this.settings))})};constr.prototype.reset=function(){this.editor.setValue(this.settings.value)};return constr}(jQuery));pinion.backend.input.UpdateTextbox=(function($){var constr;constr=function(settings){this.build(settings)};pinion.inherit(constr,pinion.backend.input.Textbox);constr.prototype.reset=function(){constr.uber.reset.call(this);this.$displayText.html(jQuery.trim(this.$input.val())!=""?this.$input.val():"<i>"+pinion.translate("empty string")+"</i>")};constr.prototype.build=function(settings){var _this=this;this.$element=$("<div class='pinion-backend-input-UpdateTextbox'></div>");if(settings.bigger)this.$element.addClass("pinion-biggerInput");this.$input=$("<input type='"+(settings.password?"password":"text")+"' value='"+settings.value+"'></input>").keyup(function(event){if(event.which==13){$(this).hide();_this.$display.show();var val=_this.$input.val();_this.settings.value=val;if($.trim(val)=="")val="<i>"+pinion.translate("empty string")+"</i>";else if(settings.password){var valLength=val.length;val="";while(valLength){val+="*";valLength--}};_this.$displayText.html(val)}}).hide();this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;this.$display=$("<div class='pinion-textContainer'></div>").click(function(){$(this).hide();$iconPen.hide();_this.$input.show().focus()}).hover(function(){$iconPen.show()},function(){$iconPen.hide()}).appendTo(this.$inputWrapper);var val=this.$input.val();if($.trim(val)=="")val="<i>"+pinion.translate("empty string")+"</i>";else if(settings.password){var valLength=val.length;val="";while(valLength){val+="*";valLength--}};this.$displayText=$("<span class='pinion-text'></span>").html(val).appendTo(this.$display);var $iconPen=$("<div class='pinion-backend-icon-pen'></div>").appendTo(this.$display).hide();if(settings.infoKey===undefined){if(settings.label!="")settings.infoKey=settings.label;else settings.infoKey="value"}};return constr}(jQuery));pinion.backend.input.AutoCompleteUpdateTextbox=(function($){var constr,AutoCompleteTextbox=pinion.backend.input.AutoCompleteTextbox.prototype;constr=function(settings){this.build(settings)};pinion.inherit(constr,pinion.backend.input.UpdateTextbox);constr.prototype.defaultSettings={value:"",data:[],bigger:false};constr.prototype.init=function(){constr.uber.init.call(this);AutoCompleteTextbox.addAutoComplete.call(this)};return constr}(jQuery));(function($){$.unserialize=function(str){var output={};var strData=str.split("&");for(var i=0,length=strData.length;i<length;i++){var keyAndValue=strData[i].split("=");if(keyAndValue.length==2)output[keyAndValue[0]]=keyAndValue[1]};return output};$.fn.reverse=Array.prototype.reverse;$.fn.sortChildren=function(fn){this.children().sort(fn).appendTo(this);return this};$.fn.textRunner=(function(){var currentHover;return function(){return this.children(".text").wrap("<span class='textWrapper textRunner-title'></span>").end().one("mouseenter",function(){var $this=$(this),$textWrapper=$this.children(".textWrapper").removeClass("textRunner-title"),$text=$textWrapper.children(".text"),textWidth=$text.width(),textWrapperWidth=$textWrapper.width(),mouseenter=function(){currentHover=$this;var diff=textWidth-textWrapperWidth,moveText=function(){setTimeout(function(){if(currentHover===$this)$text.animate({"margin-left":-diff},diff*50,"easeInOutSine",setToStart)},500)},setToStart=function(){setTimeout(function(){if(currentHover===$this){$text.css("margin-left",0);moveText()}},1200)};moveText()};if(textWidth>textWrapperWidth){$this.hover(mouseenter,function(){currentHover=null;$(this).children(".textWrapper").children(".text").stop(true,false).css("margin-left",0)});mouseenter()}else $textWrapper.addClass("textRunner-title")})}}());$.fn.boxMove=(function(){var defaultOptions={direction:"horizontal",windowSize:100,wait:1000};return function(options){options=$.extend({},defaultOptions,options);return this.wrap("<div class='pinion-"+options.direction+"-move'>").one("mouseenter",function(){var $this=$(this),$parent=$this.parent(),size=options.direction=="horizontal"?$this.width():$this.height(),pos=options.direction=="horizontal"?$parent.position().left:$parent.position().top,windowSize=options.windowSize-pos,diff=size-windowSize;if(diff>0){var enter,leave,hovered=false,wait=options.wait;if(options.direction=="horizontal"){enter=function(){hovered=true;setTimeout(function(){if(hovered){$this.animate({left:-diff},diff*50,"linear",function(){setTimeout(function(){if(hovered)$this.animate({left:0},diff*50,"linear",enter)},wait)})}},wait)};leave=function(){hovered=false;$this.stop(true).css("left",0)}}else{enter=function(){hovered=true;setTimeout(function(){if(hovered){$this.animate({top:-diff},diff*50,"linear",function(){setTimeout(function(){if(hovered)$this.animate({top:0},diff*50,"linear",enter)},wait)})}},wait)};leave=function(){hovered=false;$this.stop(true).css("top",0)}};$this.hover(enter,leave);enter()}})}}())}(jQuery));pinion.namespace("backend.list");pinion.backend.list.Finder=(function($){var constr,loadingString=pinion.translate("loading"),sortColumns=function(of,desc){var $this=$(this);var dataColumn=$(this).parent().parent().attr("data-column");of.$childrenContainer.sortChildren(function(a,b){var valueA=$(a).children().children(".column-"+dataColumn).text().toLowerCase();var valueB=$(b).children().children(".column-"+dataColumn).text().toLowerCase();if(desc)return valueA<valueB?1:-1;else return valueA>valueB?1:-1});$this.closest(".pinion-backend-list-Finder-labels").find(".pinion-sortedBy").removeClass("pinion-sortedBy");$this.addClass("pinion-sortedBy")};constr=function(settings,backend){var _this=this;settings.positions=[];this.dragElements=[];this.values=[];this.$childrenContainer=$("<ol class='pinion-backend-list-Finder-elements'></ol>");this.$dragElement=this.$childrenContainer;this.$element=$("<div class='pinion-backend-list-Finder'></div>");this.$floatContainer=$("<div class='pinion-backend-list-floatContainer'></div>").appendTo(this.$element);this.$scrollContainer=$("<div class='pinion-backend-list-Finder-scroll'></div>").append(this.$childrenContainer).appendTo(this.$floatContainer);if(settings.label){this.$floatContainer.prepend("<label class='pinion-label'>"+settings.label+"</label>");this.$inputWrapper=$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$floatContainer);this.$inputWrapper.append(this.$scrollContainer)};if(typeof settings.renderer==="object"&&settings.renderer.name===undefined)settings.renderer.name="DataRenderer";else if(typeof settings.renderer==="string")settings.renderer={name:settings.renderer};else if(settings.renderer===undefined)settings.renderer={name:"DataRenderer"};if(settings.infoKey===undefined){if(settings.label!="")settings.infoKey=settings.label;else settings.infoKey="value"};var selectable=settings.selectable;if(selectable===true)settings.selectable={}};constr.prototype={constructor:pinion.backend.list.Finder,defaultSettings:{data:[],validators:{},selectable:false,scrollable:false,multiple:false,recursive:false},pushData:function(dataSet){this.addRenderer(dataSet);this.settings.data=this.settings.data.concat(dataSet);this.info.data=this.settings.data},addData:function(dataSet){this.setData(this.settings.data.concat(dataSet));this.setDirty()},setData:function(dataSet){var _this=this;this.clearChildrenContainer();this.settings.data=$.extend([],dataSet);this.info.data=this.settings.data;if(dataSet!==undefined&&dataSet.length>0){this.$element.removeClass("pinion-empty");if(typeof this.settings.recursive==="string"){var startDataSet=[];for(var i=0,length=dataSet.length;i<length;i++){var data=dataSet[i];if(data.deleted)continue;if(data[this.settings.recursive]==null)startDataSet.push(data);else if(this.settings.recursiveData[data[this.settings.recursive]]===undefined)this.settings.recursiveData[data[this.settings.recursive]]=[data];else this.settings.recursiveData[data[this.settings.recursive]].push(data)};dataSet=startDataSet};this.$labels=$("<div class='pinion-backend-list-Finder-labels clearfix'>&nbsp;</div>").insertBefore(this.$scrollContainer);if(this.settings.renderer.name=="DataRenderer"){this.$labels.html("");this.columnKeys=[];this.$element.addClass("default");this.dataColumns={};for(var key in dataSet[0]){if(key=="id")continue;if(key==this.settings.recursive)continue;this.columnKeys.push(key);var labeledKey=key;if(this.settings.label!==undefined&&this.settings.label[key]!==undefined)labeledKey=this.settings.label[key];var $label=$("<div class='column-"+key+"' data-column='"+key+"'></div>").appendTo(this.$labels);var $sortIcons=$("<div class='pinion-sortIcons'></div>").appendTo($label);$("<div class='pinion-backend-icon-arrowUp8-grey'></div>").click(function(){sortColumns.call(this,_this)}).appendTo($sortIcons);$("<div class='pinion-backend-icon-arrowDown8-grey'></div>").click(function(){sortColumns.call(this,_this,true)}).appendTo($sortIcons);$("<div class='pinion-text'>"+labeledKey+"</div>").appendTo($label);this.dataColumns[key]=[$label]}};this.addRenderer(dataSet)}else this.$element.addClass("pinion-empty")},clearChildrenContainer:function(){this.dataColumns=undefined;this.settings.recursiveData={};this.$childrenContainer.hide().children("li").remove();this.removeChildren();if(this.$labels)this.$labels.remove()},addRenderer:function(dataSet,$list){var $loadingStatusbar=$("<div class='pinion-loading-info-statusbar'></div>"),$loadingInfo=$("<div class='pinion-loading-info'><div class='pinion-loading-info-text'>"+loadingString+"</div></div>").append($loadingStatusbar).appendTo(this.$element);pinion.processArray(dataSet,function(data){if(data.deleted)return;if(pinion.backend.renderer[this.settings.renderer.name]!==undefined){var element=this.addChild($.extend({recursive:this.settings.recursive,type:"renderer",data:data},this.settings.renderer));if($list===undefined)element.$element.wrap("<li class='pinion-list-item'></li>");else $("<li class='pinion-list-item'></li>").append(element.$element).appendTo($list);this.initRenderer(element)}else $("<div>No Renderer '"+this.settings.renderer.name+"' available!</div>").appendTo(this.$childrenContainer)},this,function(status){$loadingStatusbar.css("width",status+"%")},function(){var _this=this;this.$childrenContainer.show();this.alignData();if(this.$scrollContainer.height()>600&&this.settings.scrollable){this.$scrollContainer.addClass("scrollContainer").height(400).bind('jsp-initialised',function(event,isScrollable){if(isScrollable)_this.$element.addClass("scrollable").removeClass("notScrollable")}).jScrollPane({verticalGutter:-8,showArrows:true})}else this.$element.addClass("notScrollable");var selectable=this.settings.selectable;if(Array.isArray(selectable.items)){var $children=pinion.$(this.children);for(var i=selectable.items.length;i--;)$children.filter("[data-id='"+selectable.items[i]+"']").addClass("ui-selected")};$loadingInfo.remove();this.settings.positions=this.getData();this.fire("afterDataSet");this.validate()})},initRenderer:function(element){var data=element.data;element.$element.addClass("pinion-list-renderer");if(data.id)element.$element.attr("data-id",data.id);if(this.settings.recursiveData[data.id]!=null){var $ol=$("<ol></ol>");this.addRenderer(this.settings.recursiveData[data.id],$ol);$ol.insertAfter(element.$element)};var draggable={};if(this.settings.renderer.draggable instanceof Object)$.extend(draggable,this.settings.renderer.draggable);if(data.draggable instanceof Object)$.extend(draggable,data.draggable);if(this.settings.renderer.draggable||data.draggable){element.$dragElement=element.$dragElement?element.$dragElement:element.$element;this.dragElements.push({element:element,options:draggable})};if(this.settings.renderer.name=="DataRenderer"){var counter=0;var $columns=element.$element.children();for(var column in this.dataColumns){this.dataColumns[column].push($columns.eq(counter));counter++}};element.on("remove","_domRemove",this);element.on("hide","_domHide",this)},alignData:function(){var maxWidths={},rowWidth=0;if(this.dataColumns!==undefined){for(var column in this.dataColumns){maxWidths[column]=0;for(var i=0,length=this.dataColumns[column].length;i<length;i++){var width=this.dataColumns[column][i].width();if(width>maxWidths[column])maxWidths[column]=width};for(i=0;i<length;i++)this.dataColumns[column][i].width(maxWidths[column]);rowWidth+=this.dataColumns[column][0].outerWidth()};this.$labels.width(rowWidth)};if(this.$labels!=undefined)this.$labels.insertBefore(this.$controlTop);this.$element.find(".scrollContainer").each(function(){$(this).data("jsp").reinitialise({verticalGutter:-8,showArrows:true})})},updateScrolling:function(){var _this=this;this.$element.removeClass("scrollable").removeClass("notScrollable");var jsp=this.$scrollContainer.data("jsp");if(jsp){jsp.destroy();this.$scrollContainer=this.$floatContainer.find(".scrollContainer").bind('jsp-initialised',function(event,isScrollable){if(isScrollable)_this.$element.addClass("scrollable").removeClass("notScrollable");else _this.$element.addClass("notScrollable")}).jScrollPane({verticalGutter:-8})}else this.$element.addClass("notScrollable")},init:function(){var _this=this,length,i;this.on("save",function(){this.getData()}).on("update",function(event){_this.setData(event.ajaxData);_this.fire("afterUpdate")}).on("reset",function(){_this.setData(this.initSettings.data);_this.fire("afterReset")}).on("removeDuplicates",function(info){var dataNames=info.duplicate.split(",");for(var i=0,length=dataNames.length;i<length;i++)dataNames[i]=$.trim(dataNames[i]);var toRemove=[];for(i=0,length=info.relation.children.length;i<length;i++){var relationData=this.children[i].settings.data;for(var j=0,elementsLength=this.children.length;j<elementsLength;j++){var elementData=_this.children[j].settings.data;var equal=true;for(var k=0,duplicatesLength=dataNames.length;k<duplicatesLength;k++){var dataName=dataNames[k];if($.toJSON(relationData[dataName])!=$.toJSON(elementData[dataName])){equal=false;break}};if(equal)toRemove.push(this.children[j])}};for(i=0,length=toRemove.length;i<length;i++)this.removeRenderer(toRemove[i]);this.fire("afterRemoveDuplicates")});this.$dirtyFlag.appendTo(this.$floatContainer);this.setData(this.settings.data);for(i in this.settings.listener){var listenerEvent=this.settings.listener[i];var listenerInfo=i.split(".");var source=this.backend.elements[listenerInfo[0]];var eventFunction;if(typeof listenerEvent==="object"){if(listenerEvent.events!==undefined)eventFunction=function(event,data){var events=pinion.addInfo(data.triggerEvent.events,data.source.info);pinion.ajax(events,function(data){for(var evt in data)_this.fire(evt,{ajaxData:data[evt]})})};else if(listenerEvent.type!==undefined)eventFunction=function(event,data){data.triggerEvent.relation=data.source;_this.fire(data.triggerEvent.type,data.triggerEvent)}}else eventFunction=function(event,data){_this.fire(data.triggerEvent,data)};source.on(listenerInfo[1],{source:source,triggerEvent:listenerEvent},eventFunction)};this.$controlTop=$("<div class='pinion-backend-finder-control'><div class='pinion-backend-icon-arrowUp'></div></div>").mousedown(function(){_this.scrollUp=true;var scrollApi=_this.$scrollContainer.data("jsp");var triggerMousewheel=function(){scrollApi.scrollBy(0,-10);setTimeout(function(){if(_this.scrollUp)triggerMousewheel()},40)};triggerMousewheel()}).mouseup(function(){_this.scrollUp=false}).insertBefore(this.$scrollContainer);$("<div class='pinion-backend-finder-control'><div class='pinion-backend-icon-arrowDown'></div></div>").mousedown(function(){_this.scrollDown=true;var scrollApi=_this.$scrollContainer.data("jsp");var triggerMousewheel=function(){scrollApi.scrollBy(0,10);setTimeout(function(){if(_this.scrollDown)triggerMousewheel()},40)};triggerMousewheel()}).mouseup(function(){_this.scrollDown=false}).insertAfter(this.$scrollContainer);this.$warning=$("<div class='pinion-backend-warning'></div>").appendTo(this.$floatContainer);if(this.settings.draggable)this.setDraggable(this,this.settings.draggable);for(i=0,length=this.dragElements.length;i<length;i++)this.setDraggable(this.dragElements[i].element,this.dragElements[i].options);if(this.settings.selectable){if(this.settings.multiple===false)this.info[this.settings.infoKey]=null;else this.info[this.settings.infoKey]=[];var options={filter:".pinion-list-renderer",stop:function(){var $selected=pinion.$(_this.children).filter(".ui-selected");_this.info[_this.settings.infoKey]=[];$selected.each(function(){if(_this.settings.multiple===false){if($selected.length>0)_this.info[_this.settings.infoKey]=$(this).attr("data-id");else _this.info[_this.settings.infoKey]=null}else _this.info[_this.settings.infoKey].push($(this).attr("data-id"))});if($selected.length>0)_this.setDirty();else _this.setClean()}};if(!this.settings.multiple)options.selected=function(event,ui){$(ui.selected).siblings(".ui-selected").removeClass("ui-selected")};this.$childrenContainer.selectable(options)}},getData:function(){var ids=[],newData=[],_this=this;var addItems=function($element,parentId){$element.children(".pinion-list-item").each(function(i){var $this=$(this),$renderer=$this.children(".pinion-list-renderer"),renderer=$renderer.data("element"),id=renderer.data.id;newData.push(renderer.data);if(_this.settings.recursive){renderer.data[_this.settings.recursive]=parentId;if(renderer.data.position!==undefined)renderer.data.position=i;ids.push({id:id,position:i,parent:parentId})}else{if(renderer.data.position!==undefined)renderer.data.position=i;ids.push(id)};var $childrenList=$this.children("ol");if($childrenList.length>0)addItems($childrenList,id)})};addItems(this.$childrenContainer,null);this.settings.data=newData;_this.info.data=_this.settings.data;return ids},setDraggable:function(element,options){var _this=this;var fn;if(this.settings.recursive!==false)fn=element.$dragElement.nestedSortable;else fn=element.$dragElement.sortable;element.$dragElement.addClass("pinion-draggable").addClass("pinion-draggable-"+this.settings.identifier);fn.call(element.$dragElement,{toleranceElement:"> .pinion-list-renderer",tolerance:'pointer',distance:20,cursor:"move",helper:"clone",handle:'.pinion-list-renderer',items:"li.pinion-list-item",placeholder:'pinion-drag-placeholder',forcePlaceholderSize:true,forceHelperSize:true,connectWith:(pinion.drag.connections[this.identifier]!==undefined)?pinion.drag.connections[this.identifier]:false,appendTo:_this.backend.$outerContainer,start:function(event,ui){pinion.drag.active=true;pinion.drag.index=ui.item.index();ui.helper.mousewheel(function(event,delta,deltaX,deltaY){_this.backend.$childrenContainer.trigger("mousewheel",[delta,deltaX,deltaY]);return false}).addClass("pinion-drag")},beforeStop:function(event,ui){ui.helper.removeClass("pinion-drag")},stop:function(event,ui){pinion.drag.active=false},update:function(event,ui){_this.updateScrolling();var oldPositions=$.toJSON(_this.settings.positions);var positions=_this.getData();var newPositions=$.toJSON(positions);if(oldPositions!=newPositions)_this.setDirty();else _this.setClean()},sort:function(event,ui){if(ui.position.left<0)ui.helper.css("margin-left",-ui.position.left);else ui.helper.css("margin-left",0)},receive:function(event,ui){var sendList=ui.sender.data("element");if(ui.item.parent().attr("data-dragMode")=="copy")ui.sender.eq(pinion.drag.index).before(ui.item.clone(true));else{ui.sender.find(".scrollContainer").each(function(){$(this).data("jsp").reinitialise({verticalGutter:-8,showArrows:true})});if(ui.sender.children(".pinion-list-item").length==0)sendList.$element.addClass("pinion-empty")};var receivedElement=ui.item.children(".pinion-list-renderer").data("element");_this.$element.removeClass("pinion-empty");if(_this.settings.renderer.name!=receivedElement.settings.name){receivedElement.fire("convert");receivedElement=receivedElement.replaceBy($.extend({type:"renderer",data:receivedElement.settings.data},_this.settings.renderer),_this);_this.initRenderer(receivedElement);receivedElement.setDirty();receivedElement.fire("afterConvert")}else receivedElement.setDirty();_this.alignData()}});if(typeof options.accept==="string")options.accept=[options.accept];if(Array.isArray(options.accept)){for(var j=0,droppableLength=options.accept.length;j<droppableLength;j++){var dragAccept=options.accept[j];var $draggables=$(".pinion-draggable-"+dragAccept);if(this.backend.elements[dragAccept]!==undefined&&$draggables.length>0){var connectionValue=$draggables.first().sortable("option","connectWith");if(connectionValue===false)$draggables.sortable("option","connectWith",".pinion-draggable-"+this.settings.identifier);else $draggables.sortable("option","connectWith",connectionValue+", .pinion-draggable-"+this.settings.identifier)}else if(pinion.drag.connections[dragAccept]!==undefined)pinion.drag.connections[dragAccept]+=", .pinion-draggable-"+this.settings.identifier;else pinion.drag.connections[dragAccept]=".pinion-draggable-"+this.settings.identifier}};if(options.copy==0)element.$dragElement.attr("data-dragMode","move");else element.$dragElement.attr("data-dragMode","copy")},removeRenderer:function(renderer){renderer.remove()},hideRenderer:function(renderer){renderer.hide()},_domRemove:function(event){var data=this.settings.data,sender=event.sender,index=data.indexOf(sender);sender.$element.parent().remove();if(index!=-1)data.splice(index,1);this._domChange()},_domHide:function(event){event.sender.data.deleted=true;event.sender.$element.parent().hide();this._domChange()},_domChange:function(){if(this.children.length==0)this.$element.addClass("pinion-empty");if(this.settings.draggable)this.$dragElement.sortable("refresh")},validate:function(){if(this.validators.minOne!==undefined){window.childCon=this.$childrenContainer;if(this.children.length==0)return this.setInvalid("There must be at least one element")};if(this.validators.oneSelected!==undefined){if(!(pinion.$(this.children).filter(".ui-selected").length==1))return this.setInvalid("Not exactly one element selected")};if(this.validators.minOneSelected!==undefined){if(!(pinion.$(this.children).filter(".ui-selected").length>0))return this.setInvalid("Not at least one element selected")};this.setValid()},reset:function(){this.setData(this.initSettings.data)}};return constr}(jQuery));pinion.backend.list.Selector=(function($){var constr;constr=function(settings,backend){this.changeDefaultValues(settings);this.$element=$("<div class='pinion-backend-list-Selector'></div>");this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;this.$select=$("<select></select>")};constr.prototype={constructor:pinion.backend.list.Selector,defaultSettings:{value:null,noEmptyValue:false,data:[],description:null,idAsDescription:true,translateValues:true,bigger:false},changeDefaultValues:function(settings){if(settings.infoKey===undefined){if(settings.label!="")settings.infoKey=settings.label;else settings.infoKey="value"};if(settings.value==null&&settings.noEmptyValue){var data=settings.data;if(data.length>0)settings.value=settings.data[0].id}},init:function(){var _this=this,settings=this.settings,data=settings.data;if(settings.label)this.$label=$("<label class='pinion-label'>"+pinion.translate(settings.label)+"</label>").prependTo(this.$element);this.$select.change(function(){var value=$(this).children(":selected").attr("data-id");value=(value===undefined)?null:value;_this.info[_this.settings.infoKey]=_this.settings.value=value;if(value==_this.initSettings.value)_this.setClean();else _this.setDirty()}).appendTo(this.$inputWrapper);this.setData(data);if(this.settings.bigger)this.$element.addClass("pinion-biggerInput")},val:function(){return this.$select.val()},validate:function(){if(this.validators.notEmpty){if(this.$select.children(":selected").attr("data-id")===this.initSettings.value)return this.setInvalid("This field is required")};return this.backend.setValid(this)},reset:function(){var $selected;if(this.settings.value==null)$selected=this.$select.children(":first").attr('selected','selected');else $selected=this.$select.children("[data-id='"+this.settings.value+"']").attr('selected','selected');this.info[this.settings.infoKey]=this.settings.value=$selected.attr("data-id");if(this.settings.dirty=="always")this.setDirty()},setData:function(data){var _this=this;if(!Array.isArray(data)){pinion.ajax(data,function(data){_this.setData(data.data)});return};this.settings.data=this.initSettings.data=data;this.$select.html("");if(!this.settings.noEmptyValue)this.$select.append("<option></option>");this.$warning=$("<div class='pinion-backend-warning'></div>").appendTo(this.$inputWrapper);var length=data.length;if(length>0){var description=null;if(this.settings.idAsDescription)description="id";if(this.settings.description)description=this.settings.description;else for(var name in data[0]){if(name=="id")continue;description=name;break};for(var i=0;i<length;i++){var dataRow=data[i];var $option=$("<option></option>").appendTo(this.$select);var id=dataRow.id;if(id==this.settings.value)$option.attr("selected","selected");$option.attr("data-id",id);if(description){var value=dataRow[description];if(this.settings.translateValues)value=pinion.translate(value);$option.text(value)}}};this.setClean();this.reset()}};return constr}(jQuery));pinion.backend.list.UpdateSelector=(function($){var constr;constr=function(settings){var _this=this;this.changeDefaultValues(settings);this.$element=$("<div class='pinion-backend-list-UpdateSelector'></div>");this.$select=$("<select></select>").on("change",function(event){$(this).hide();_this.$display.show();var val=_this.$select.val();if($.trim(val)=="")val="<i>"+pinion.translate("empty string")+"</i>";else if(settings.password){var valLength=val.length;val="";while(valLength){val+="*";valLength--}};_this.$displayText.html(val)}).hide();this.$inputWrapper=settings.label?$("<div class='pinion-backend-inputwrapper'></div>").appendTo(this.$element):this.$element;this.$display=$("<div class='pinion-textContainer'></div>").click(function(){$(this).hide();_this.$iconPen.hide();_this.$select.show().focus()}).hover(function(){_this.$iconPen.show()},function(){_this.$iconPen.hide()}).appendTo(this.$inputWrapper);this.$displayText=$("<span class='pinion-text'></span>")};return constr}(jQuery));pinion.inherit(pinion.backend.list.UpdateSelector,pinion.backend.list.Selector);pinion.backend.list.UpdateSelector.prototype.reset=function(){pinion.backend.list.UpdateSelector.uber.reset.call(this);var val=this.$select.children(":selected").val();this.$displayText.html(jQuery.trim(val)!=""?val:"<i>"+pinion.translate("empty string")+"</i>")};pinion.backend.list.UpdateSelector.prototype.init=function(){pinion.backend.list.UpdateSelector.uber.init.call(this);var val=this.$select.children(":selected").val();if(jQuery.trim(val)=="")val="<i>"+pinion.translate("empty string")+"</i>";else if(this.settings.password){var valLength=val.length;val="";while(valLength){val+="*";valLength--}};this.$displayText.html(val).appendTo(this.$display);this.$iconPen=jQuery("<div class='pinion-backend-icon-pen'></div>").appendTo(this.$display).hide()};pinion.on("addModule",function(data){var FrontendBox=pinion.FrontendBox,$parent=FrontendBox.getParent(),$contentElement=$parent.closest(".cms"),$newModuleContentElement=jQuery("<div class='cms cms-content'></div>"),newModule;$contentElement[data.mode]($newModuleContentElement);newModule=pinion.Frontend.getModuleElement(data.name,{content:{areaname:$contentElement.data("element").content.areaname}},$newModuleContentElement,true);newModule.$editButton.click();FrontendBox.hide();if($contentElement.hasClass("cms-areaPlaceholder"))$contentElement.remove()});pinion.Module=(function($){var constr,FrontendBox=pinion.FrontendBox,userid=pinion.php.userid,hasAddModuleButton=(function(){var php=pinion.php,modules=php.modules,permissions=php.permissions;for(var i in modules){var module=modules[i];if(module.isFrontend&&pinion.hasPermission(i,"add"))return true};return false}());constr=function(){};constr.modulize=function(module){module.dirtyElements={};module.validations={};module.elements={};module.indices={};module.mode="frontend";module.editMode=false;module.elements[module.identifier]=module;module.settings=$.extend(true,{},module.globalElementSettings,module.settings);module.identifier=module.settings.identifier;module.initSettings=$.extend(true,{},module.settings);module.backend=module;module.info=module.settings.info;module.content=module.settings.content;module.data=module.settings.data;module.vars=module.settings.vars;module.children=[];module._isDirty=false;module._isChanged=false;module._isValid=null;module._inizialized=false;module.$contents=module.$contentElement.contents();module._isOwnData=(module.data.user_id&&module.data.user_id==userid);module._isOwnContent=(module.content.user_id&&module.content.user_id==userid);module.on("dirty",function(){module.$contentElement.addClass("dirty");module.parent.dirtyElements[module.identifier]=module}).on("clean",function(){module.$contentElement.removeClass("dirty");delete module.parent.dirtyElements[module.identifier]}).on("saveStart",function(data){if(module.mode=="frontend"){if(module.settings._isNew)data.events.push({module:"page",event:"addContent",info:{identifier:module.identifier,areaname:module.settings.content.areaname}})}}).on("saveDone",function(){module.resetElement(module,true)});if(!module.content.visible)module.$contentElement.addClass("pinion-invisible");if(!module.settings._isNew&&module.content.content_id==null&&module.content.module!="page")module.$contentElement.addClass("pinion-areaContent");module.$contentElement.hover(function(){if(!module.editMode)module.$contentElement.addClass("pinion-hover")},function(){var $parent=FrontendBox.getParent();if(!module.editMode&&(!$parent||!$parent.parent().is($iconBar)))module.$contentElement.removeClass("pinion-hover")});module.saveClick=function(){if($submitButton.hasClass("disabled"))return;FrontendBox.hide();$submitButton.addClass("disabled");module.save();loader=new pinion.Loader();$submitButton.addClass("pinion-loading").append(loader.$element);module.one("invalid",function(){$submitButton.removeClass("pinion-loading");loader.remove()});module.one("saveDone",function(){$submitButton.removeClass("pinion-loading");loader.remove()})};var name=module.name=module.settings.moduleName,$iconBarWrapper=$("<div class='pinion-Module-iconBarWrapper'></div>"),$iconBar=$("<div class='pinion-Module-iconBar'></div>"),$editBar=$("<div class='pinion-Module-editBar'></div>"),loader,$submitButton=$("<div class='pinion-backend-icon-submit'></div>").click(module.saveClick).addClass("disabled").appendTo($editBar);module.on("invalid",function(){$submitButton.addClass("disabled")}).on("dirty",function(){if(pinion.isEmpty(module.validations))$submitButton.removeClass("disabled")}).on("clean",function(){$submitButton.addClass("disabled")}).on("savePossible",function(){$submitButton.removeClass("disabled")});pinion.registerHelp($submitButton,"save the content");var $cancelButton=$("<div class='pinion-backend-icon-cancel'></div>").click(function(){FrontendBox.hide();if(module.settings._isNew){var $contentElement=module.$contentElement;$contentElement.fadeOut(300,function(){pinion.fire("removeModule",module);pinion.Frontend.instance.removeElement(module);$contentElement.remove()})}else{module.$contentElement.removeClass("pinion-editMode");module.editMode=false;$iconBarWrapper.css("display","");module.$contents.appendTo(module.$contentElement);module.$element.hide();module.resetElement(module)}}).appendTo($editBar);pinion.registerHelp($cancelButton,"cancel the edit mode");$("<div class='pinion-Module-iconBar-separator'></div>").appendTo($editBar);if(pinion.hasPermission(name,"backend")){var $backendButton=pinion.$link("",name).addClass("pinion-backend-icon-backend").appendTo($editBar);pinion.registerHelp($backendButton,"go to the backend of the module")};var $refreshButton=$("<div class='pinion-backend-icon-refresh'></div>").click(function(){var newModule;FrontendBox.hide();if(module.settings._isNew){var $newModuleContentElement=$("<div class='cms cms-content'></div>");module.$contentElement.after($newModuleContentElement);newModule=pinion.Frontend.getModuleElement(module.name,{data:{areaname:module.content.areaname}},$newModuleContentElement,true);pinion.fire("removeModule",module);pinion.Frontend.instance.removeElement(module);module.$contentElement.remove()}else newModule=pinion.Frontend.replaceContent(module.settings.contentId,pinion.php.content[module.settings.contentId].html);newModule.$editButton.click()}).appendTo($editBar);pinion.registerHelp($refreshButton,"refresh the editor");if(pinion.hasPermission(name,"add existing")||pinion.hasPermission(name,"add existing of own")){$("<div class='pinion-Module-iconBar-separator'></div>").appendTo($editBar);var $contentButton=$("<div class='pinion-backend-icon-content'></div>").click(function(){if($contentButton.hasClass("pinion-active"))FrontendBox.hide();else FrontendBox.show($contentButton,pinion.frontend.ContentList.show(module),{steps:250})}).appendTo($editBar);pinion.registerHelp($contentButton,"add existing content")};var $minimizeButton=$("<div class='pinion-Module-editBar-arrow'></div>").click(pinion.Module.prototype.getMinimizeHandler.call($minimizeButton)).appendTo($editBar);pinion.registerHelp($minimizeButton,"minimize/maximize this bar");$("<div class='pinion-Module-editBarWrapper'></div>").append($editBar).appendTo(module.$element);module.$element.hide();module.$dirtyFlag.appendTo(module.$contentElement);var hasOneIcon=false;if(pinion.hasPermission(name,"edit")||(pinion.hasPermission(name,"edit own")&&module._isOwnData)||module.settings._isNew){hasOneIcon=true;module.$editButton=$("<div class='pinion-backend-icon-edit'></div>").click(function(){if(!module._initialized){module._inizializeElements(module);module.init();module._initialized=true};module.$contentElement.addClass("pinion-editMode");module.editMode=true;$iconBarWrapper.hide();module.$contents.detach();module.$element.show();module.fire("edit");FrontendBox.hide()}).appendTo($iconBar);pinion.registerHelp(module.$editButton,"Edit this content");module.$revisionButton=$("<div class='pinion-backend-icon-revision'></div>").click(function(){if(module.$revisionButton.hasClass("pinion-active"))FrontendBox.hide();else FrontendBox.show(module.$revisionButton,pinion.frontend.RevisionList.show(module.name,module.settings.moduleId),{steps:80})}).appendTo($iconBar);pinion.registerHelp(module.$revisionButton,"Show revisions")};if(pinion.hasPermission(name,"change visibility")||(pinion.hasPermission(name,"change visibility of own")&&module._isOwnContent)){hasOneIcon=true;var $visible=$("<div class='pinion-backend-icon-visible'></div>").click(function(){pinion.fire("changeVisibility",module);FrontendBox.hide()}).appendTo($iconBar);pinion.registerHelp($visible,"Change the visibility of this content")};if(pinion.hasPermission(name,"change assignment")||(pinion.hasPermission(name,"change assignment of own")&&module._isOwnContent)){hasOneIcon=true;var $visible=$("<div class='pinion-backend-icon-belonging'></div>").click(function(){pinion.fire("changeBelonging",module);FrontendBox.hide()}).appendTo($iconBar);pinion.registerHelp($visible,"Change belonging (page or area) of content")};if(pinion.hasPermission(name,"delete")||(pinion.hasPermission(name,"delete own")&&module._isOwnContent)){hasOneIcon=true;var $remove=$("<div class='pinion-backend-icon-remove'></div>").click(function(){var $contentElement=module.$contentElement;$contentElement.fadeOut(300,function(){pinion.fire("removeModule",module);module._isDeleted=true;if(module.settings._isNew){pinion.Frontend.instance.removeElement(module);$contentElement.remove()}});FrontendBox.hide()}).appendTo($iconBar);pinion.registerHelp($remove,"Remove this content")};if(pinion.hasPermission(name,"change style")||(pinion.hasPermission(name,"change style of own")&&module._isOwnContent)){hasOneIcon=true;module.$style=$("<div class='pinion-backend-icon-style'></div>").click(function(){if(module.$style.hasClass("pinion-active"))FrontendBox.hide();else FrontendBox.show(module.$style,pinion.frontend.StyleList.show(module),{steps:80})}).appendTo($iconBar);pinion.registerHelp(module.$style,"Change styling")};if(hasAddModuleButton){if(hasOneIcon)$("<div class='pinion-Module-iconBar-separator'></div>").appendTo($iconBar);hasOneIcon=true;module.$add=$("<div class='pinion-backend-icon-add'></div>").click(function(){if(module.$add.hasClass("pinion-active"))FrontendBox.hide();else FrontendBox.show(module.$add,pinion.frontend.$moduleMenu,{steps:80})}).appendTo($iconBar);pinion.registerHelp(module.$add,"Add a new content")};if(hasOneIcon){var $minimizeIconbarButton=$("<div class='pinion-Module-iconBar-arrow'></div>").click(pinion.Module.prototype.getMinimizeHandler.call($minimizeIconbarButton)).appendTo($iconBar);pinion.registerHelp($minimizeIconbarButton,"minimize/maximize this bar");$iconBarWrapper.append($iconBar).appendTo(module.$contentElement)}};constr.prototype={constructor:pinion.Module,getMinimizeHandler:function(){var minimized=false,buttonWidth,barWidth,doAnimation=false;return function(){FrontendBox.hide();var $this=$(this),$bar=$(this).parent();if(buttonWidth===undefined){buttonWidth=$this.outerWidth();barWidth=$bar.outerWidth()};if(doAnimation)return false;doAnimation=true;if(minimized)$bar.animate({"margin-left":0},300,function(){$bar.removeClass("pinion-minimized");doAnimation=false});else $bar.animate({"margin-left":-barWidth+buttonWidth},300,function(){$bar.addClass("pinion-minimized");doAnimation=false});minimized=!minimized;return false}}};return constr}(jQuery));pinion.namespace("backend.module.defaultModule");pinion.backend.module.defaultModule=(function($){var constr;constr=function(settings){this.$element=$("<div>");settings.events=[{event:settings._isNew?"add":"edit",module:settings.moduleName,info:settings._isNew?{identifier:settings.identifier}:{id:settings.moduleId}}];settings.groupEvents=true};constr.prototype={constructor:pinion.backend.module.defaultModule,init:function(){var settings=this.settings;this.addChild({name:"AjaxSection",type:"group",data:{event:"defineEditor",module:settings.moduleName,info:{settings:settings}},validate:"all",groupEvents:true})}};return constr}(jQuery));pinion.namespace("backend.Overlay");pinion.backend.Overlay=(function($){var $overlay=$("<div id='pinion-backend-Overlay'></div>").hide(),$body,$element=$overlay,showed=false,speed=1000,show=function(){if(!showed){showed=true;$body.addClass("pinion-overlay");$overlay.fadeIn(speed)}},hide=function(){if(showed){showed=false;$overlay.fadeOut(speed,function(){$body.removeClass("pinion-overlay")})}};$(function(){$body=$("body");$element.appendTo(pinion.$backend)});return {$element:$element,show:show,hide:hide}}(jQuery));pinion.namespace("pinion.data");pinion.data.Timeinfo=function(data,clazz){var now=new Date().getTime();var created=pinion.data.formatDate(data.created,now);var updated=pinion.data.formatDate(data.updated,now);if(created.type=="time")created=pinion.translate(false,"created %s %s ago","<span class='pinion-timeSpecification'>"+created.val+" ",pinion.translate(created.unit)+"</span>");else created=pinion.translate(false,"created on %s","<span class='pinion-timeSpecification'>"+created.val+"</span>");if(updated.type=="time")updated=pinion.translate(false,"updated %s %s ago","<span class='pinion-timeSpecification'>"+updated.val+" ",pinion.translate(updated.unit)+"</span>");else updated=pinion.translate(false,"updated on %s","<span class='pinion-timeSpecification'>"+updated.val+"</span>");clazz=clazz?" "+clazz:"";jQuery("<div class='pinion-timeinfo"+clazz+"'></div>").append("<div class='pinion-backend-icon-clock'></div>").append("<div class='pinion-text'>"+created+", "+updated+"</div>").appendTo(this.$element)};pinion.data.formatDate=function(timeStamp,now){var diff=now-timeStamp*1000;var diffRounded;var unit;diff=diff/1000/60;diffRounded=Math.round(diff);if(diffRounded<60){unit="minutes";if(diffRounded<1)diffRounded=1;if(diffRounded==1)unit="minute";return {type:"time",unit:unit,val:diffRounded}};diff=diff/60;diffRounded=Math.round(diff);if(diff<24){unit="hours";if(diffRounded==1)unit="hour";return {type:"time",unit:unit,val:diffRounded}};diff=diff/24;diffRounded=Math.round(diff);if(diff<10){unit="days";if(diffRounded==1)unit="day";return {type:"time",unit:unit,val:diffRounded}};var date=new Date(timeStamp*1000);return {type:"date",val:date.getDate()+"."+date.getMonth()+"."+date.getFullYear()}};pinion.data.Userinfo=function(data,clazz){clazz=clazz?" "+clazz:"";jQuery("<div class='pinion-authorinfo"+clazz+"'><div class='pinion-backend-icon-user12px-grey'></div></div>").append(jQuery("<div class='pinion-text'></div>").append(pinion.$link(data.user,"permissions","user"))).appendTo(this.$element)};pinion.data.Revisioninfo=function(data,clazz){clazz=clazz?" "+clazz:"";jQuery("<div class='pinion-revisioninfo"+clazz+"'><div class='pinion-backend-icon-revision12px-grey'></div><div class='pinion-text'>"+data.revision+"</div></div>").appendTo(this.$element)};pinion.data.Info=function(infos,data){var dataNamespace=pinion.data;for(var i=0,length=infos.length;i<length;i++)dataNamespace[infos[i]+"info"].call(this,data,"pinion-"+length+"info")};pinion.data.Bar=function(elements){var $bar=jQuery("<div class='pinion-renderer-bar'>").appendTo(this.$element);for(var i=0,length=elements.length;i<length;i++)$bar.append(elements[i])};pinion.data.Delete=function(data,callback,clazz){var _this=this,clb=(callback instanceof Function)?callback:function(){data.deleted=true;_this.fadeOut(300,function(){_this.setDirty()})};clazz=clazz?" "+clazz:"";return jQuery("<div class='pinion-delete"+clazz+"'><div class='pinion-icon'></div><div class='pinion-text'>"+pinion.translate("delete")+"</div></div>").click(clb)};pinion.namespace("backend.renderer.DataRenderer");pinion.backend.renderer.DataRenderer=(function($){var constr;constr=function(settings,backend){this.data=settings.data;this.$element=$("<div class='pinion-backend-list-Finder-row'></div>")};constr.prototype={constructor:pinion.backend.renderer.DataRenderer,init:function(){this.info=this.settings.data;for(var i=0,length=this.parent.columnKeys.length;i<length;i++){var key=this.parent.columnKeys[i];$("<div class='column-"+key+"'>"+this.data[key]+"</div>").appendTo(this.$element)};this.$dirtyFlag.appendTo(this.$element)}};return constr}(jQuery));pinion.namespace("backend.table.DataTable");pinion.backend.table.DataTable=(function($){var _this,constr,showData=function(){_this.$element.html("");var $tBody=$("<tbody></tbody>");for(var i=0,dataLength=_this.data.length;i<dataLength;i++){var row=_this.data[i];if(i==0){var $tHead=$("<thead></thead>").appendTo(_this.$element);$tBody.appendTo(_this.$element);var $tr=$("<tr></tr>").appendTo($tHead);for(var key in row){if(key=="id")continue;if(_this.settings.label!==undefined&&_this.settings.label[key]!==undefined)key=_this.settings.label[key];$tr.append("<th>"+key+"</th>")}};var $tr=$("<tr></tr>").appendTo($tBody);for(var key in row){if(key=="id"){$tr.attr("data-id",row[key]);continue};$tr.append("<td>"+row[key]+"</td>")}}};constr=function(settings){_this=this;this.settings=settings;this.$element=$("<table class='pinion-backend-DataFinder'></table>");if(typeof settings.dataEvent==="object")pinion.ajax(settings.dataEvent,function(data){this.data=data;showData()});else if(Array.isArray(settings.data)){this.data=settings.data;showData()}else console.error("No data or no dataFunction given.")};constr.prototype={constructor:pinion.backend.table.DataTable,version:"1.0"};return constr}(jQuery));pinion.namespace("backend.text.Headline");pinion.backend.text.Headline=(function($){var constr;constr=function(settings){this.$element=$("<h2 class='pinion-backend-text-Headline'>"+pinion.translate(settings.text)+"</h2>")};constr.prototype={constructor:pinion.backend.text.Headline,text:function(str){if(str){this.$element.text(str);return this}else return this.$element.text()}};return constr}(jQuery));pinion.namespace("backend.text.Code");pinion.backend.text.Code=(function($){var constr;constr=function(settings){var output="";if(settings.text!==undefined)output=settings.text;else if(settings.array!==undefined)output=this.parseObject(settings.array,0);this.$element=$("<code>"+output+"</code>")};constr.prototype={constructor:pinion.backend.text.Code,parseObject:function(obj,level){var output="",margin=(function(){var m="";var l=level;while(l){m+="    ";l--};return m}());if(obj==null)return "null";switch(typeof obj){case"object":{output+="array(\n";var key,length=pinion.length(obj),counter=0;if(Array.isArray(obj)){for(;counter<length;counter++){output+=margin+"    "+this.parseObject(obj[counter],level+1);if(counter+1!=length)output+=",";output+="\n"}}else for(key in obj)if(obj.hasOwnProperty(key)){counter++;output+=margin+"    \""+key+"\" => "+this.parseObject(obj[key],level+1);if(counter!=length)output+=",";output+="\n"};output+=margin+")";break};case"number":{output+=obj;break};case"string":default:{output+="\""+obj+"\"";break}};return output}};return constr}(jQuery));pinion.threads=(function($){var threads={},hasWebWorker=false,add=function(threadPath,data,receiveFunction){if(data instanceof Function){receiveFunction=data;data={}};data.cmd="start";try{$.Hive.create({worker:threadPath+'/worker.js',receive:receiveFunction});var infoThread=$.Hive.get(0);threads[threadPath]=infoThread;infoThread.send(data);hasWebWorker=true}catch(error){pinion.require(threadPath+"/timeout.js",function(){threads[threadPath]=pinion.threads.thread;threads[threadPath].receiveFunction=receiveFunction;threads[threadPath].start()});threads[threadPath]=threadPath}},remove=function(threadPath){if(threads[threadPath]===undefined)return false;if(hasWebWorker){threads[threadPath].send({cmd:"stop"});$.Hive.destroy(threads[threadPath].id)}else{threads[threadPath].stop();$("script[src='"+threadPath+"/timeout.js']").remove()};delete threads[threadPath];return true};return {threads:threads,add:add,remove:remove}}(jQuery));jQuery(function($){pinion.threads.add(pinion.php.url+"pinion/js/threads/info",{user:pinion.php.user,url:pinion.php.url,data:$.toJSON({events:[{module:"permissions",event:"update"}]}),updateInterval:pinion.php.updateInterval},function(data){for(var i in data.events){var event=data.events[i];if(event.name==="userOnline"){pinion.showMessage(pinion.translate(false,"The user %s is now online","<b>"+event.data.username+"</b>"));pinion.php.user[event.data.id]=event.data};if(event.name==="userOffline"){pinion.showMessage(pinion.translate(false,"The user %s is now offline","<b>"+event.data.username+"</b>"));delete pinion.php.user[event.data.id]};if(event.name==="message")pinion.showMessage(event.data);if(event.name==="files")pinion.require(event.data);pinion.fire(event.name,event.data)}})});pinion.backend.group.LazyAddGroup=(function($){var constr;constr=function(settings){this.$element=$("<div class='pinion-backend-group-LazyAddGroup'></div>");this.elements=[];this.counter=0;this.group=null};constr.prototype={constructor:pinion.backend.group.LazyAddGroup,defaultSettings:{label:"add",group:{},groupEvents:true,mode:"multiple",data:[],appendTo:null},init:function(){var _this=this,settings=this.settings,clickHandler;if(settings.appendTo)this.appendTo=settings.appendTo;else this.appendTo=this.$element;if(settings.mode=="single"){clickHandler=function(){if(_this.group){if(_this.open){_this.group.$element.detach();_this.open=false}else{_this.group.$element.appendTo(_this.appendTo);_this.open=true}}else{var elements=$.extend(true,[],_this.elements);_this.group=_this.addChild({name:"Section",type:"group",groupEvents:true},_this.settings.group);for(var i=0,length=elements.length;i<length;i++){var element=elements[i];if(element.parent==_this.identifier)element.parent=_this.group.identifier};_this.backend.addElements(elements,_this.group);_this.group.$element.appendTo(_this.appendTo);_this.open=true}}}else clickHandler=function(){var elements=$.extend(true,[],_this.elements);_this.addSection(elements)};var button=this.addChild({name:"Button",type:"input",label:this.settings.label,click:clickHandler});this.on("dirty",function(){button.$element.addClass("pinion-active")}).on("clean",function(){button.$element.removeClass("pinion-active")});for(var i=0,length=settings.data.length;i<length;i++){var d=settings.data[i];var elements=$.extend(true,[],_this.elements);for(var j=0,elementsLength=elements.length;j<elementsLength;j++){var element=elements[j];var infoKey;if(element.infoKey)infoKey=element.infoKey;else infoKey=element.label;if(d[infoKey])element.value=d[infoKey]};this.addSection(elements)}},addSection:function(elements){var count=++this.counter;if(this.group==null){this.group=this.addChild($.extend({name:"SelectGroup",type:"group",groupEvents:"groupEvent"},this.settings.group));this.group.$element.appendTo(this.appendTo)};var section=this.group.addChild({name:"TitledSection",type:"group",groupEvents:true,title:count});for(var i=0,length=elements.length;i<length;i++){var element=elements[i];element.identifier=element.identifier+"@LazyAddGroup_"+count;if(element.parent==this.identifier)element.parent=section.identifier;else{element.parent=element.parent+"@LazyAddGroup_"+count;if(element.lazy)element.lazy=element.lazy+"@LazyAddGroup_"+count}};this.backend.addElements(elements,section)},reset:function(){if(this.group){this.counter=0;this.group.remove();this.group=null}}};return constr}(jQuery));pinion.backend.group.AjaxSection=(function($){var constr;constr=function(settings){this.$element=$("<div class='pinion-backend-group-Section'></div>")};pinion.inherit(constr,pinion.backend.group.Section);constr.prototype.defaultSettings={loadByInit:true};constr.prototype.init=function(){if(this.settings.loadByInit)this.load()};constr.prototype.load=function(){var _this=this,loader=new pinion.Loader("darkblue-40px",40);loader.$element.appendTo(this.$element);pinion.ajax(this.settings.data,function(data){loader.remove();var elements=data.elements;_this.asParentFor(elements).addElements(elements)})};return constr}(jQuery));pinion.backend.group.AjaxTitledGroup=(function(){var constr;constr=function(settings){settings.open=false;this.build(settings);this.hasLoaded=false};pinion.inherit(constr,pinion.backend.group.TitledGroup);constr.prototype.open=function(){if(!this.hasLoaded){this.hasLoaded=true;this.load(true)}else constr.uber.open.call(this)};constr.prototype.load=function(open){var _this=this,loader=new pinion.Loader("darkblue");loader.$element.appendTo(this.$h2);pinion.ajax(this.settings.data,function(data){var elements=data.elements;_this.asParentFor(elements).addElements(elements);if(open)setTimeout(function(){loader.remove();constr.uber.open.call(_this)},250);else loader.remove()})},constr.prototype.reload=function(){if(this.hasLoaded){constr.uber.close.call(this);this.removeChildren();this.load(false)}};return constr}());pinion.backend.group.AjaxTitledSection=(function($){var constr;constr=function(settings){this.build(settings)};pinion.inherit(constr,pinion.backend.group.TitledSection);constr.prototype.init=function(){constr.uber.init.call(this);var _this=this,loader=new pinion.Loader("darkblue-40px",40);loader.$element.appendTo(this.$childrenContainer);pinion.ajax(this.settings.data,function(data){loader.remove();var elements=data.elements;_this.asParentFor(elements).addElements(elements)})};return constr}(jQuery));pinion.backend.group.AjaxWrapper=(function($){var constr;constr=function(settings){this.$element=settings.$element};constr.prototype={constructor:pinion.backend.group.Wrapper,init:function(){this.$dirtyFlag.remove();this.loadAjaxElements()}},constr.prototype.loadAjaxElements=function(){var _this=this,loader=new pinion.Loader("darkblue-40px",40);loader.$element.appendTo(this.$element);pinion.ajax(this.settings.data,function(data){loader.remove();var elements=data.elements;_this.asParentFor(elements).addElements(elements)})};return constr}(jQuery));pinion.backend.group.AjaxSearchSection=(function($){var constr,ElementBase=pinion.backend.ElementBase;constr=function(settings){this.$element=$("<div class='pinion-backend-group-Section'></div>")};pinion.inherit(constr,pinion.backend.group.Section);constr.prototype.defaultSettings={groupEvents:true};constr.prototype.init=function(){this.addChild({name:"Button",type:"input",label:"search",click:function(){var loader=new pinion.Loader("darkblue-40px",40),dirtyElements={},events=[];resultWrapper.removeChildren();loader.$element.appendTo(resultWrapper);for(var i=_this.children.length;i--;){var child=_this.children[i];if(child!=resultWrapper)ElementBase.getDirtyElements(child,dirtyElements)};canCollect=true;events=this.backend._collectEvents(dirtyElements);canCollect=false;pinion.ajax(events,function(data){loader.remove();var elements=data.elements;resultWrapper.asParentFor(elements).addElements(elements)})}});var _this=this,canCollect=false,resultWrapper=this.addChild({name:"Wrapper",type:"group",$element:this.$element});var elements=[],children=this.children;for(var i=children.length;i--;){var child=children[i];if(child!=resultWrapper)ElementBase.getElements(child,elements)};for(i in elements)elements[i].on("save",function(){return canCollect})};return constr}(jQuery));pinion.backend.list.DataPager=(function($){var constr;constr=function(settings){this.currentSite=0;this.finder=[];this.dataLength=0;this.hasAllData=false;this.$element=$("<div class='pinion-backend-list-DataPager'></div>")};constr.prototype={constructor:pinion.backend.list.DataPager,defaultSettings:{data:[],dataPerSite:10,group:"SelectGroup",display:{}},init:function(){var _this=this,settings=this.settings,data=settings.data;if(Array.isArray(data)){this.hasAllData=true;this.dataLength=data.length;if(this.dataLength>0){this.buildGroup();this.finder[this.currentSite]=true;this.buildFinder(data.slice(0,settings.dataPerSite))}}else{data.info=data.info||{};data.info.start=0;data.info.end=settings.dataPerSite;pinion.ajax(data,function(d){if(d.dataLength!==undefined)_this.dataLength=parseInt(d.dataLength,10);else{this.hasAllData=true;_this.dataLength=d.data.length};if(_this.dataLength>0){_this.buildGroup();_this.finder[_this.currentSite]=true;_this.buildFinder(d.data.slice(0,settings.dataPerSite))}})}},showSite:function(){var index=this.currentSite;if(this.finder[index]==null){this.finder[index]=true;var settings=this.settings,dataPerSite=settings.dataPerSite,data;if(this.hasAllData){data=settings.data.slice(index*dataPerSite,(index+1)*dataPerSite);this.finder[index]=this.buildFinder(data)}else{var _this=this,event=this.settings.data;event.info.start=index*dataPerSite;event.info.end=(index+1)*dataPerSite;var loader=new pinion.Loader("darkblue-40px",40);loader.$element.appendTo(this.group.children[this.currentSite].$childrenContainer);pinion.ajax(event,function(d){loader.remove();_this.finder[index]=_this.buildFinder(d.data)})}}},buildFinder:function(data){var settings=this.settings,display=settings.display;display=this.group.children[this.currentSite].addChild($.extend({},{name:"Finder",type:"list",data:data},display));this.fire("addDisplay",{display:display});return display},buildGroup:function(){this.backend.doInitialization=false;this.group=this.addChild({name:this.settings.group,type:"group",label:"site",groupEvents:!!this.settings.groupEvents});this.backend.doInitialization=true;var count=0;for(var i=0,length=this.dataLength;i<length;i+=this.settings.dataPerSite){this.finder.push(null);this.group.addChild({name:"TitledSection",type:"group",title:++count,groupEvents:!!this.settings.groupEvents})};this.group.init();this.group.on("changeContent",function(data){this.currentSite=parseInt(data.headline,10)-1;this.showSite()},this)}};return constr}(jQuery));